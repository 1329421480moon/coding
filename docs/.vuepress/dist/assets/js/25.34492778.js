(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{287:function(a,t,s){"use strict";s.r(t);var e=s(0),r=Object(e.a)({},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"lamp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lamp","aria-hidden":"true"}},[a._v("#")]),a._v(" LAMP")]),a._v(" "),s("blockquote",[s("p",[a._v("后盾人 @ 版权所有 ，请尊重他人劳动成果，转载请注明出处 houdunren.com。")]),a._v(" "),s("p",[a._v("感谢你的支持与理解。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://www.houdunren.com/xj.png",alt:"icon-s"}})]),a._v(" "),s("p",[a._v("下面介绍自己开发一个运行 LAMP 环境的docker镜像及容器的使用，有关docker的使用已经在其他docker课程中介绍了，向军大叔在这里就不重复讲了。")]),a._v(" "),s("h2",{attrs:{id:"安装镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装镜像","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装镜像")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 搜索镜像\ndocker search ubuntu\n\n# 安装ubuntu镜像\ndocker pull ubuntu\n\n# 查看镜像列表\ndocker image\n")])])]),s("h2",{attrs:{id:"启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动容器","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动容器")]),a._v(" "),s("p",[a._v("以守护进程启动容器，如果ubuntu镜像本地不存在，将自动从 hub.docker.com下载。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -tid -p 8080:80 ubuntu /bin/bash\n")])])]),s("p",[a._v("查看运行的容器")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker ps\n")])])]),s("p",[a._v("使用容器 CONTAINER-ID 登录容器")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker exec -itd 3c5e00452777 /bin/bash\n")])])]),s("p",[a._v("-it 可以使用登录的容器并进行操作。")]),a._v(" "),s("p",[a._v("-d 参数表示容器以守护进程方式启动。")]),a._v(" "),s("h2",{attrs:{id:"软件安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软件安装","aria-hidden":"true"}},[a._v("#")]),a._v(" 软件安装")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("apt update\napt upgrade \napt install -y nginx php vim mysql-client mysql-server redis cron php-gd php-fpm\n")])])]),s("h2",{attrs:{id:"nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx","aria-hidden":"true"}},[a._v("#")]),a._v(" Nginx")]),a._v(" "),s("h4",{attrs:{id:"php-socket连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php-socket连接","aria-hidden":"true"}},[a._v("#")]),a._v(" PHP socket连接")]),a._v(" "),s("p",[a._v("查看 "),s("code",[a._v("vim /etc/php/7.2/fpm/pool.d/www.conf")]),a._v(" 配置文件获取 "),s("code",[a._v("socket")]),a._v(" 连接地址。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\nlisten = /run/php/php7.2-fpm.sock\n...\n")])])]),s("p",[a._v("修改nginx配置文件 "),s("code",[a._v("vi /etc/nginx/sites-enabled/default")]),a._v(" 中的php连接方式")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("location ~ \\.php$ {\n\t\tinclude snippets/fastcgi-php.conf;\n\t\t\t# With php-fpm (or other unix sockets):\n\t\t\t#  /run/php/php7.2-fpm.sock\n\t\t\tfastcgi_pass unix:/run/php/php7.2-fpm.sock;\n\t\t\t# With php-cgi (or other tcp sockets):\n\t\t\t# fastcgi_pass 127.0.0.1:9000;\n}\n")])])]),s("h4",{attrs:{id:"php通过ip连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php通过ip连接","aria-hidden":"true"}},[a._v("#")]),a._v(" PHP通过IP连接")]),a._v(" "),s("p",[a._v("除了使用上面的socket连接外，也可以使用ip方式连接。")]),a._v(" "),s("p",[a._v("修改php-fpm配置文件 "),s("code",[a._v("vim /etc/php/7.2/fpm/pool.d/www.conf")]),a._v(" 中的 listen配置段如下：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\n;listen = /run/php/php7.2-fpm.sock\nlisten = 127.0.0.1:9000\n...\n")])])]),s("p",[a._v("修改nginx配置项 "),s("code",[a._v("vim /etc/nginx/sites-enabled/default")]),a._v(" 配置项如下：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("location ~ \\.php$ {\n\t\tinclude snippets/fastcgi-php.conf;\n        #\n        #       # With php-fpm (or other unix sockets):\n        #       fastcgi_pass unix:/run/php/php7.2-fpm.sock;\n        #       # With php-cgi (or other tcp sockets):\n\t\tfastcgi_pass 127.0.0.1:9000;\n}\n")])])]),s("h4",{attrs:{id:"访问测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问测试","aria-hidden":"true"}},[a._v("#")]),a._v(" 访问测试")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("service nginx start\nservice php7.2-fpm start\nservice mysql start\n")])])]),s("p",[a._v("创建 "),s("code",[a._v("/var/www/html/houdunren.php")]),a._v(" 内容如下：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<?php \nphpinfo();\n")])])]),s("p",[a._v("在宿主机的浏览器访问 "),s("code",[a._v("localhost:8080")])]),a._v(" "),s("p",[a._v("##Mysql")]),a._v(" "),s("p",[s("strong",[a._v("root 帐号远程访问")])]),a._v(" "),s("p",[a._v("使用下面两种方式的任一种来设置root帐号可以远程连接。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("通过 "),s("code",[a._v("mysql_secure_installation")]),a._v(" 命令完成设置")])]),a._v(" "),s("li",[s("p",[a._v("使用mysql命令完成")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v(" set global validate_password_policy=LOW;\n")])])])])]),a._v(" "),s("p",[a._v("grant all privileges on "),s("em",[a._v(".")]),a._v(" to 'root'@'%' identified by 'admin888';\nFLUSH PRIVILEGES;\n```")]),a._v(" "),s("p",[s("strong",[a._v("mysql配置")])]),a._v(" "),s("p",[a._v("修改配置文件允许外部IP访问")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim /etc/mysql/mysql.conf.d/mysqld.cnf\n")])])]),s("p",[a._v("注释掉下面这行")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# bind-address          = 127.0.0.1\n")])])]),s("p",[s("strong",[a._v("运行设置")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("usermod -d /var/lib/mysql/ mysql\nchown -R mysql:mysql /var/lib/mysql\n")])])]),s("h2",{attrs:{id:"启动脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动脚本","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动脚本")]),a._v(" "),s("p",[a._v("在容器要多目录创建 boot.sh 文件内容如下")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("chown -R mysql:mysql /var/lib/mysql\nservice php7.2-fpm start\nservice mysql start\nnginx -g 'daemon off;'\n")])])]),s("p",[a._v("nginx -g 'daemon off; 是让nginx在前台执行，以保证容器启动时几个服务不退出。")]),a._v(" "),s("h2",{attrs:{id:"制作镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#制作镜像","aria-hidden":"true"}},[a._v("#")]),a._v(" 制作镜像")]),a._v(" "),s("p",[a._v("刚刚安装软件的容器需要保存为镜像，否则每次都需要重新安装软件。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('docker commit -m="first commit" -a="houdunren" 3c5e00452777 houdunren/web:v2\n')])])]),s("p",[a._v("各个参数说明：")]),a._v(" "),s("ul",[s("li",[a._v("**-m:**提交的描述信息")]),a._v(" "),s("li",[a._v("**-a:**指定镜像作者")]),a._v(" "),s("li",[a._v("**3c5e00452777：**容器ID")]),a._v(" "),s("li",[s("strong",[a._v("houdunren/ubuntu:v1")]),a._v("指定要创建的目标镜像名")])]),a._v(" "),s("p",[a._v("创建镜像后我们可以使用 "),s("strong",[a._v("docker images")]),a._v(" 命令来查看我们的新镜像 "),s("strong",[a._v("houdunren/ubuntu:v2")]),a._v("：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -tid houdunren/lamp:v2 /bin/bash\n")])])]),s("p",[a._v("镜像标签")]),a._v(" "),s("p",[a._v("镜像的名称也可以更改，比如将上面的镜像改名操作")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker tag 3c5e00452777 houdunren/lamp\n")])])]),s("h2",{attrs:{id:"启动测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动测试","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动测试")]),a._v(" "),s("p",[s("strong",[a._v("启动容器")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -tid -p 8088:80 -p 3308:3306 -v /www:/var/www/html --name hd houdunren/web /bin/bash boot.sh\n")])])]),s("p",[s("strong",[a._v("开启服务")])]),a._v(" "),s("p",[a._v("如果没有创建启动脚本  boot.sh，需要登录容器执行以下命令。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 进入容器\nservice php7.2-fpm start\nservice nginx start\nservice mysql start\n")])])]),s("p",[s("strong",[a._v("宿主连接mysql")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql -uroot -p -P3309 -h127.0.0.1\n")])])]),s("h2",{attrs:{id:"发布镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布镜像","aria-hidden":"true"}},[a._v("#")]),a._v(" 发布镜像")]),a._v(" "),s("p",[a._v("命令行登录docker")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker login\n# 退出\ndocker logout\n")])])]),s("p",[s("strong",[a._v("发布镜像到服务器")])]),a._v(" "),s("p",[a._v("如果不是以 "),s("code",[a._v("帐号/镜像")]),a._v(" 形式的命名规则，将不能提交到docker")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 改镜像名，不设置tag 将为 latest版本\ndocker tag 355f96772628 houdunren/web:v1\n\n# 发布提交\ndocker push web:v1\n")])])])])},[],!1,null,null,null);t.default=r.exports}}]);