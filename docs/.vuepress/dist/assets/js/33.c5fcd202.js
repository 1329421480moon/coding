(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{260:function(e,a,n){"use strict";n.r(a);var t=n(0),r=Object(t.a)({},function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"扩展包开发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#扩展包开发","aria-hidden":"true"}},[e._v("#")]),e._v(" 扩展包开发")]),e._v(" "),n("p",[e._v("扩展包是对软件功能的扩充，下面我们开发一个多网关上传扩展包，目前支持阿里云OSS上传。")]),e._v(" "),n("p",[e._v("本项目地址："),n("a",{attrs:{href:"https://github.com/houdunwang/uploader",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/houdunwang/uploader"),n("OutboundLink")],1)]),e._v(" "),n("blockquote",[n("p",[e._v("后盾人 www.houdunren.com  作者："),n("a",{attrs:{href:"http://www.aoxiangjun.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("向军大叔"),n("OutboundLink")],1)])]),e._v(" "),n("h2",{attrs:{id:"软件特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#软件特点","aria-hidden":"true"}},[e._v("#")]),e._v(" 软件特点")]),e._v(" "),n("ul",[n("li",[e._v("支持多网关处理业务")]),e._v(" "),n("li",[e._v("提供provider与facade支持，完美集成Laravel框架")]),e._v(" "),n("li",[e._v("单元测试全覆盖，保证代码健壮")]),e._v(" "),n("li",[e._v("发布到Github与packagist.org开源共享")]),e._v(" "),n("li",[e._v("使用简单可快速集成到项目中")])]),e._v(" "),n("h2",{attrs:{id:"基础构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础构建","aria-hidden":"true"}},[e._v("#")]),e._v(" 基础构建")]),e._v(" "),n("h3",{attrs:{id:"创建目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建目录","aria-hidden":"true"}},[e._v("#")]),e._v(" 创建目录")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ mkdir uploader\n")])])]),n("h3",{attrs:{id:"composer-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#composer-配置","aria-hidden":"true"}},[e._v("#")]),e._v(" composer 配置")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ cd uploader\n$ composer init # 一直回车\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('This command will guide you through creating your composer.json config.\n\nPackage name (<vendor>/<name>) [xj/uploader]: houdunwang/uploader \nDescription []:\nAuthor [houdunwang <2300071698@qq.com>, n to skip]:\nMinimum Stability []:\nPackage Type (e.g. library, project, metapackage, composer-plugin) []:\nLicense []:\n\nDefine your dependencies.\n\nWould you like to define your dependencies (require) interactively [yes]?\nSearch for a package:\nWould you like to define your dev dependencies (require-dev) interactively [yes]?\nSearch for a package:\n\n{\n    "name": "houdunwang/uploader",\n    "authors": [\n        {\n            "name": "houdunwang",\n            "email": "2300071698@qq.com"\n        }\n    ],\n    "require": {},\n}\n\nDo you confirm generation [yes]?\n')])])]),n("p",[e._v("说明")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# houdunwang为我Github帐号，你要填写你的Github库名称\nAuthor [houdunwang <2300071698@qq.com>, n to skip]: 你Github帐号\n剩下一直回车即可\n")])])]),n("h3",{attrs:{id:"目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目录结构","aria-hidden":"true"}},[e._v("#")]),e._v(" 目录结构")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("├── config\t\t\t# 配置文件目录\n├── composer.json  \n├── phpunit.xml\t\t# 单元测试配置文件\n├── src\t\t\t\t# 软件代码\n│   └── Exceptions  # 异常处理\n│   └── Services  # 处理服务类\n└── tests\t\t\t# 测试代码\n")])])]),n("p",[e._v("修改 composer.json 设置自动加载")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('...\n"autoload": {\n\t"psr-4": {\n\t\t"Houdunwang\\\\Uploader\\\\": "src/"\n\t}\n}\n...\n')])])]),n("p",[e._v("设置单元测试配置文件")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('<?xml version="1.0" encoding="UTF-8"?>\n<phpunit backupGlobals="false"\n         backupStaticAttributes="false"\n         bootstrap="vendor/autoload.php"\n         colors="true"\n         convertErrorsToExceptions="true"\n         convertNoticesToExceptions="true"\n         convertWarningsToExceptions="true"\n         processIsolation="false"\n         stopOnFailure="false"\n         syntaxCheck="false"\n>\n    <testsuites>\n        <testsuite name="Prettus Repository Test Suite">\n            <directory suffix=".php">./tests/</directory>\n        </testsuite>\n    </testsuites>\n</phpunit>\n')])])]),n("h3",{attrs:{id:"配置站点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置站点","aria-hidden":"true"}},[e._v("#")]),e._v(" 配置站点")]),e._v(" "),n("p",[e._v("下面是我的 homestead 的配置，如果你使用 wamp 等集成开发环境可以省略这一步。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sites:\n    - map: uploader.test\n      to: /home/vagrant/code/components/uploader\n")])])]),n("p",[e._v("配置 host 文件")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("192.168.10.10   uploader.test\n")])])]),n("h3",{attrs:{id:"安装依赖包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖包","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装依赖包")]),e._v(" "),n("p",[e._v("安装以下两个依赖包用于软件的单元测试")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ composer require phpunit/phpunit mockery/mockery \n$ composer require aliyuncs/oss-sdk-php  \n")])])]),n("ul",[n("li",[e._v("phpunit/phpunit mockery/mockery 用于单元测试的组件")]),e._v(" "),n("li",[e._v("aliyuncs/oss-sdk-php  阿里云提供的OSS上传库")])]),e._v(" "),n("h2",{attrs:{id:"业务实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务实现","aria-hidden":"true"}},[e._v("#")]),e._v(" 业务实现")]),e._v(" "),n("h3",{attrs:{id:"软件配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#软件配置","aria-hidden":"true"}},[e._v("#")]),e._v(" 软件配置")]),e._v(" "),n("p",[e._v("配置文件定义在 "),n("code",[e._v("config/uploader.php")]),e._v("，内容如下：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\nreturn [\n    'oss' => [\n        'accessKeyId' => '',\n        'accessKeySecret' => '',\n        'bucket' => '',\n        'endpoint' => '',\n    ],\n];\n")])])]),n("h3",{attrs:{id:"异常处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#异常处理","aria-hidden":"true"}},[e._v("#")]),e._v(" 异常处理")]),e._v(" "),n("p",[e._v("异常处理用于处理运行错误，比如用户参数错误、Http处理错误等。下面是我们定义的异常处理类")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("src\n│   ├── Exceptions\n│   │   ├── Exception.php\t# 基础异常\n│   │   ├── InvalidParamException.php # 参数错误异常\n│   │   └── ServerDisposeException.php # 服务网关异常(如调用阿里oss服务异常)\n")])])]),n("p",[e._v("下面是各个异常类")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("namespace Houdunwang\\Uploader\\Exceptions;\nclass Exception extends \\Exception\n{\n\n}\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("namespace Houdunwang\\Uploader\\Exceptions;\nclass InvalidParamException extends Exception\n{\n\n}\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("namespace Houdunwang\\Uploader\\Exceptions;\nclass ServerDisposeException extends Exception\n{\n\n}\n")])])]),n("h3",{attrs:{id:"业务代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务代码","aria-hidden":"true"}},[e._v("#")]),e._v(" 业务代码")]),e._v(" "),n("p",[n("strong",[e._v("扩展包入口类")])]),e._v(" "),n("p",[e._v("因为上传支持多个服务，我们使用 "),n("code",[e._v("Uploader")]),e._v(" 类统一调用处理。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nnamespace Houdunwang\\Uploader;\n\nuse Houdunwang\\Uploader\\Exceptions\\InvalidParamException;\nuse Houdunwang\\Uploader\\Services\\OssServer;\n\nclass Uploader\n{\n    protected $config;\n\n    /**\n     * 服务列表\n     * @var array\n     */\n    protected $servers = [\n        'oss' => OssServer::class,\n    ];\n\n    public function config(array $config): Uploader\n    {\n        $this->config = $config;\n        return $this;\n    }\n\n    /**\n     * 上传处理\n     * @param string $file\n     * @param string $service\n     * @return string 文件\n     * @throws InvalidParamException\n     */\n    public function upload(string $file, string $service='oss'): string\n    {\n        if (!is_string($file) || !is_file($file)) {\n            throw new InvalidParamException('invalid file param');\n        }\n        if (!in_array($service, ['oss', 'local'])) {\n            throw new ServerDisposeException('service dones not exists' . $service);\n        }\n        try {\n            $serverInstance = new $this->servers[$service];\n            return $serverInstance->config($this->config[$service])->upload($file);\n        } catch (\\Exception $e) {\n            throw new \\Exception($e->getMessage(), $e->getCode(), $e);\n        }\n    }\n}\n\n")])])]),n("p",[n("strong",[e._v("OSS")]),e._v(" 服务")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |  Software: [hdcms framework]\n * |      Site: www.hdcms.com\n * |-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nnamespace Houdunwang\\Uploader\\Services;\n\nuse Houdunwang\\Uploader\\Exceptions\\HttpException;\nuse Houdunwang\\Uploader\\Exceptions\\InvalidParamException;\nuse OSS\\OssClient;\n\nclass OssServer implements ServerInterface\n{\n    protected $config;\n\n    /**\n     * 设置配置\n     * @param array $config\n     * @return OssServer\n     * @throws InvalidParamException\n     */\n    public function config(array $config): ServerInterface\n    {\n        if (empty($config['accessKeyId']) || empty($config['accessKeySecret']) || empty($config['bucket']) || empty($config['endpoint'])) {\n            throw new InvalidParamException('server param invalid');\n        }\n        $this->config = $config;\n        return $this;\n    }\n\n    /**\n     * OSS服务\n     * @return OssClient\n     * @throws \\OSS\\Core\\OssException\n     */\n    public function getHttpClient()\n    {\n        return new OssClient($this->config['accessKeyId'], $this->config['accessKeySecret'], $this->config['endpoint']);\n    }\n\n    /**\n     * 执行上传\n     * @param string $file\n     * @return string\n     * @throws HttpException\n     * @throws InvalidParamException\n     */\n    public function upload(string $file): string\n    {\n        if (!is_string($file) || !is_file($file)) {\n            throw new InvalidParamException($file . ' is not a file');\n        }\n        try {\n            $res = $this->getHttpClient()->uploadFile($this->config['bucket'], $this->getFileName($file), $file);\n            return $res['oss-request-url'];\n        } catch (\\Exception $e) {\n            throw new HttpException($e->getMessage(), $e->getCode(), $e);\n        }\n    }\n\n    /**\n     * 随机文件名\n     * @param string $file\n     * @return string\n     */\n    public function getFileName(string $file): string\n    {\n        $extension = substr($file, strrpos($file, '.'));\n        return md5($file) . time() . $extension;\n    }\n}\n")])])]),n("h2",{attrs:{id:"laravel集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#laravel集成","aria-hidden":"true"}},[e._v("#")]),e._v(" Laravel集成")]),e._v(" "),n("p",[e._v("为了更好在Laravel框架中使用，我们需要添加 "),n("code",[e._v("provider")]),e._v(" 与 "),n("code",[e._v("Facade")]),e._v(" 支持，并在Laravel框架的 config 目录中生成扩展包配置文件。")]),e._v(" "),n("h3",{attrs:{id:"composer-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#composer-json","aria-hidden":"true"}},[e._v("#")]),e._v(" composer.json")]),e._v(" "),n("p",[e._v("首先需要在 "),n("code",[e._v("composer.json")]),e._v(" 文件中定义 "),n("code",[e._v("provider")]),e._v(" 与 "),n("code",[e._v("facade")]),e._v(" 配置项")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('{\n   ...\n    "extra": {\n        "laravel": {\n            "providers": [\n                "Houdunwang\\\\Uploader\\\\ServiceProvider"\n            ],\n            "aliases": {\n                "Uploader": "Houdunwang\\\\Uploader\\\\Facade"\n            }\n        }\n    },\n    ...\n}\n')])])]),n("h3",{attrs:{id:"provider"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#provider","aria-hidden":"true"}},[e._v("#")]),e._v(" Provider")]),e._v(" "),n("p",[e._v("创建 "),n("code",[e._v("src/ServiceProvider")]),e._v(" 服务文件")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nnamespace Houdunwang\\Uploader;\n\nclass ServiceProvider extends \\Illuminate\\Support\\ServiceProvider\n{\n    protected $defer = true;\n\n    /**\n     * 服务引导方法\n     *\n     * @return void\n     */\n    public function boot(): void\n    {\n        //发布配置文件到项目的 config 目录中\n        $this->publishes([\n            __DIR__ . '/config/uploader.php' => config_path('uploader.php'),\n        ]);\n    }\n\n    /**\n     * 注册服务\n     */\n    public function register(): void\n    {\n        $this->app->singleton(Uploader::class, function () {\n            return new Uploader();\n        });\n    }\n}\n")])])]),n("h3",{attrs:{id:"facade"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#facade","aria-hidden":"true"}},[e._v("#")]),e._v(" Facade")]),e._v(" "),n("p",[e._v("创建 "),n("code",[e._v("src/Facade")]),e._v("外观文件（方便在Laravel中以像DB::table()形式使用扩展包）")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nnamespace Houdunwang\\Uploader;\n\nuse Illuminate\\Support\\Facades\\Facade as LaravelFacade;\n\nclass Facade extends LaravelFacade\n{\n    /**\n     * 获取组件的注册名称。\n     *\n     * @return string\n     */\n    protected static function getFacadeAccessor()\n    {\n        return Uploader::class;\n    }\n}\n")])])]),n("h2",{attrs:{id:"单元测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单元测试","aria-hidden":"true"}},[e._v("#")]),e._v(" 单元测试")]),e._v(" "),n("p",[e._v("使用单元测试程序的稳定性是软件开发中必不可少的环节。")]),e._v(" "),n("h3",{attrs:{id:"命名规范"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命名规范","aria-hidden":"true"}},[e._v("#")]),e._v(" 命名规范")]),e._v(" "),n("ul",[n("li",[e._v("测试用例目录要与项目目录结构一致")]),e._v(" "),n("li",[e._v("测试用户类名为：项目类名+Test.php")]),e._v(" "),n("li",[e._v("测试用例要继承 "),n("code",[e._v("PHPUnit\\Framework\\TestCase")]),e._v(" 类")]),e._v(" "),n("li",[e._v("测试用户方法为："),n("code",[e._v("test")]),e._v("+项目类方法")])]),e._v(" "),n("h3",{attrs:{id:"单元测试-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单元测试-2","aria-hidden":"true"}},[e._v("#")]),e._v(" 单元测试")]),e._v(" "),n("p",[e._v("对OssServer服务类测试")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nuse PHPUnit\\Framework\\TestCase;\nuse Houdunwang\\Uploader\\Services\\OssServer;\nuse Mockery\\Matcher\\AnyArgs;\nuse Houdunwang\\Uploader\\Exceptions\\InvalidParamException;\n\nclass OssServerTest extends TestCase\n{\n    public function testConfig()\n    {\n        $this->expectException(InvalidParamException::class);\n        $this->expectExceptionMessage('server param invalid');\n        $oss = new OssServer();\n        $oss->config([\n            'accessKeyIda' => 'test',\n            'accessKeySecret' => 'test',\n            'bucket' => 'test',\n            'endpoint' => 'test',\n        ]);\n        $this->fail('config param exception fail');\n    }\n\n    public function testGetFileName()\n    {\n        $oss = Mockery::mock(OssServer::class)->makePartial();\n        $this->assertStringEndsWith('.jpeg', $oss->getFileName('a.jpeg'));\n    }\n\n    public function testUploadParamFile()\n    {\n        $oss = \\Mockery::mock(OssServer::class)->makePartial();\n        $this->expectException(InvalidParamException::class);\n        $this->expectExceptionMessage('a.jpeg is not a file');\n        $oss->upload('a.jpeg');\n        $this->fail('ossClient request param invalid');\n    }\n\n    public function testUpload()\n    {\n        $client = \\Mockery::mock(\\OSS\\OssClient::class);\n        $client->allows()->uploadFile(new AnyArgs())->andReturn([\n            'oss-request-url' => __FILE__,\n        ]);\n        $oss = \\Mockery::mock(OssServer::class)->makePartial();\n        $oss->allows()->getHttpClient()->andReturn($client);\n        return $this->assertSame(__FILE__, $oss->upload(__FILE__));\n    }\n}\n\n")])])]),n("p",[e._v("对扩展包入口类测试")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<?php\n/** .-------------------------------------------------------------------\n * |    Author: 向军 <www.aoxiangjun.com>\n * |    WeChat: houdunren2018\n * |      Date: 2018/11/12\n * | Copyright (c) 2012-2019, www.houdunren.com. All Rights Reserved.\n * '-------------------------------------------------------------------*/\n\nuse PHPUnit\\Framework\\TestCase;\nuse Houdunwang\\Uploader\\Exceptions\\InvalidParamException;\n\nclass UploaderTest extends TestCase\n{\n    public function testUploadParamException()\n    {\n        $uploader = new \\Houdunwang\\Uploader\\Uploader([]);\n        $this->expectException(InvalidParamException::class);\n        $this->expectExceptionMessage('invalid file param');\n        $uploader->upload('test.php', 'oss');\n\n        $this->fail('server param exception');\n\n    }\n}\n")])])]),n("p",[e._v("测试结果：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("➜  uploader git:(master) ✗ phpunit\nPHPUnit 6.1.0 by Sebastian Bergmann and contributors.\n\n.....                                                               5 / 5 (100%)\n\nTime: 98 ms, Memory: 10.00MB\n\nOK (5 tests, 8 assertions)\n➜  uploader git:(master) \n")])])]),n("h2",{attrs:{id:"项目测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#项目测试","aria-hidden":"true"}},[e._v("#")]),e._v(" 项目测试")]),e._v(" "),n("p",[e._v("下面我们在Laravel 项目中进行测试，首先使用以下命令安装laravel项目。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("composer create-project --prefer-dist laravel/laravel\n")])])]),n("p",[e._v("安装我们的本地扩展包")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ composer config repositories.uploader path ../components/uploader\n$ composer require houdunwang/uploader:dev-master\n")])])]),n("h3",{attrs:{id:"生成配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成配置文件","aria-hidden":"true"}},[e._v("#")]),e._v(" 生成配置文件")]),e._v(" "),n("p",[e._v("组件会自动发布配置文件 "),n("code",[e._v("uploader.php")]),e._v(" 到项目的 "),n("code",[e._v("config")]),e._v(" 目录中，需要先进行相应配置。")]),e._v(" "),n("p",[e._v("也可以使用以下方式手动发布配置：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ laravel php artisan vendor:publish\n\nWhich provider or tag's files would you like to publish?:\n  [0 ] Publish files from all providers and tags listed below\n  [1 ] Provider: BeyondCode\\DumpServer\\DumpServerServiceProvider\n  [2 ] Provider: Fideloper\\Proxy\\TrustedProxyServiceProvider\n  [3 ] Provider: Illuminate\\Mail\\MailServiceProvider\n  [4 ] Provider: Illuminate\\Notifications\\NotificationServiceProvider\n  [5 ] Provider: Illuminate\\Pagination\\PaginationServiceProvider\n  [6 ] Provider: Laravel\\Tinker\\TinkerServiceProvider\n  [7 ] Tag: config\n  [8 ] Tag: laravel-mail\n  [9 ] Tag: laravel-notifications\n  [10] Tag: laravel-pagination\n > 7\n\nPublishing complete.\n")])])]),n("p",[e._v("设置  "),n("code",[e._v("config/uploader.php")]),e._v(" 文件中的上传配置项。")]),e._v(" "),n("h4",{attrs:{id:"阿里云"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里云","aria-hidden":"true"}},[e._v("#")]),e._v(" 阿里云")]),e._v(" "),n("ol",[n("li",[e._v("在 "),n("code",[e._v("访问控制")]),e._v(" 中添加一个新帐号")]),e._v(" "),n("li",[e._v("获得帐号的 "),n("code",[e._v("accessKeyId")]),e._v(" 与 "),n("code",[e._v("accessKeySecret")]),e._v("资料设置到配置文件中")]),e._v(" "),n("li",[e._v("赋予新增的帐号 "),n("code",[e._v("oss")]),e._v(" 使用权限。")]),e._v(" "),n("li",[e._v("在 "),n("code",[e._v("oss")]),e._v(" 服务中新增 "),n("code",[e._v("bucket")]),e._v("  块")]),e._v(" "),n("li",[e._v("为新增的 "),n("code",[e._v("bucket")]),e._v(" 块配置跨域访问权限")]),e._v(" "),n("li",[e._v("设置块为 "),n("code",[e._v("公共读")])]),e._v(" "),n("li",[e._v("将 "),n("code",[e._v("外网访问")]),e._v(" 配置项中的 "),n("code",[e._v("EndPoint")]),e._v(" 设置到配置文件中的 "),n("code",[e._v("endpoint")]),e._v(" 项")])]),e._v(" "),n("h3",{attrs:{id:"测试扩展包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试扩展包","aria-hidden":"true"}},[e._v("#")]),e._v(" 测试扩展包")]),e._v(" "),n("p",[e._v("使用"),n("code",[e._v("Facade")]),e._v(" 调用")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Route::get('/', function () {\n\treturn Uploader::config(config('uploader'))->upload('index.php');\n});\n")])])]),n("p",[e._v("使用 "),n("code",[e._v("provider")]),e._v(" 服务调用")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Route::get('/', function () {\n\treturn app(\\Houdunwang\\Uploader\\Uploader::class)->config(config('uploader'))->upload('index.php');\n});\n")])])]),n("h2",{attrs:{id:"开源发布"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开源发布","aria-hidden":"true"}},[e._v("#")]),e._v(" 开源发布")]),e._v(" "),n("h3",{attrs:{id:"github"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#github","aria-hidden":"true"}},[e._v("#")]),e._v(" GitHub")]),e._v(" "),n("p",[e._v("在Github新建项目并执行以下命令提交代码到版本库。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('git init\ngit add README.md\ngit commit -m "first commit"\ngit remote add origin https://github.com/houdunwang/uploader.git\ngit push -u origin master\n')])])]),n("blockquote",[n("p",[e._v("别忘记改成自己的github 库地址")])]),e._v(" "),n("h3",{attrs:{id:"packagist"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#packagist","aria-hidden":"true"}},[e._v("#")]),e._v(" Packagist")]),e._v(" "),n("p",[e._v("将软件发布到 "),n("a",{attrs:{href:"https://packagist.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://packagist.org/"),n("OutboundLink")],1),e._v(" 用户就可以使用 "),n("code",[e._v("composer")]),e._v("进行安装或更新了。")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("使用 github 帐号登录 packagist")])]),e._v(" "),n("li",[n("p",[e._v("点击 "),n("a",{attrs:{href:"https://packagist.org/packages/submit",target:"_blank",rel:"noopener noreferrer"}},[e._v("Submit"),n("OutboundLink")],1),e._v(" 提交软件包，从github复制 https的地址")])]),e._v(" "),n("li",[n("p",[e._v("点击 "),n("a",{attrs:{href:"https://packagist.org/profile/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://packagist.org/profile/"),n("OutboundLink")],1),e._v(" 页面的 "),n("a",{attrs:{href:"https://packagist.org/trigger-github-sync/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://packagist.org/trigger-github-sync/"),n("OutboundLink")],1),e._v(" 与 github 同步，同步后当github 代码提交时会自动通知 packagist。")])])]),e._v(" "),n("h3",{attrs:{id:"version"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#version","aria-hidden":"true"}},[e._v("#")]),e._v(" Version")]),e._v(" "),n("p",[e._v("版本号由含义指 "),n("code",[e._v("重构或不向下兼容版本号.新功能.修复版本")]),e._v("  上面我以最直白的方式进行的版本号的说明，严格定义版本号是对使用你开源项目作者的基本责任，乱定义版本号可能造成使用者在升级后无法运行，这方便知识需要了解一下 "),n("code",[e._v("composer")]),e._v(" 中版本号的说明。")]),e._v(" "),n("p",[e._v("下面我们为软件添加每一个版本")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ git tag v1.0.0 # 添加版本号\n$ git push --tags # 向github发布\n")])])]),n("p",[e._v("发布后登录 "),n("a",{attrs:{href:"https://packagist.org/packages/houdunwang/uploader",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://packagist.org/packages/houdunwang/uploader"),n("OutboundLink")],1),e._v("就可以看到版本号了，我们软件的使用者可以使用 "),n("code",[e._v("composer update")]),e._v(" 更新了。")]),e._v(" "),n("h3",{attrs:{id:"图标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#图标","aria-hidden":"true"}},[e._v("#")]),e._v(" 图标")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://poser.pugx.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://poser.pugx.org/"),n("OutboundLink")],1),e._v(" 搜索你的项目，可生成展示下载量、协议等信息的图标。")])])},[],!1,null,null,null);a.default=r.exports}}]);