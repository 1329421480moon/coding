(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{280:function(t,e,a){"use strict";a.r(e);var n=a(0),r=Object(n.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误处理","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误处理")]),t._v(" "),a("blockquote",[a("p",[t._v("创作不易，转载请注明出处： 后盾人 @ houdunren.com")])]),t._v(" "),a("p",[t._v("PHP语言开发简单之处也体现在可以提供丰富的错误信息。")]),t._v(" "),a("h2",{attrs:{id:"错误显示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误显示","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误显示")]),t._v(" "),a("p",[t._v("修改 "),a("code",[t._v("php.ini")]),t._v(" 配置文件， "),a("code",[t._v("display_errors = On")]),t._v(" 即开启错误显示。")]),t._v(" "),a("h2",{attrs:{id:"错误类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误类型","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误类型")]),t._v(" "),a("h3",{attrs:{id:"语法错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 语法错误")]),t._v(" "),a("p",[t._v("违背了程序语言的规则错误，称之为语法错误。比如不以分号结束的语句，或函数写错时都会出现语法错误。语法错误PHP会在运行前检测出来。")]),t._v(" "),a("p",[t._v("下面代码没有以分号结束，将报语法错误")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<?php\necho 'houdunren'\n")])])]),a("p",[t._v("错误内容如下")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("( ! ) Parse error: syntax error, unexpected end of file, expecting ',' or ';' in C:\\wamp64\\www\\php\\index.php on line 3\n")])])]),a("h3",{attrs:{id:"运行错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 运行错误")]),t._v(" "),a("p",[t._v("经过语法错误检测后，将开始运行PHP代码，在此发生的错误为运行时错误。")]),t._v(" "),a("p",[t._v("以下代码因为加载不存在文件，所以会发生运行时错误。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<?php\nrequire 'houdunren';\n")])])]),a("p",[t._v("错误内容如下")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("( ! ) Warning: require(houdunren): failed to open stream: No such file or directory in C:\\wamp64\\www\\php\\index.php on line 2\n")])])]),a("p",[t._v("常见运行错误如下：")]),t._v(" "),a("ul",[a("li",[t._v("加载不存在文件")]),t._v(" "),a("li",[t._v("连接数据库失败")]),t._v(" "),a("li",[t._v("远程请求失败")]),t._v(" "),a("li",[t._v("函数或类不存在")])]),t._v(" "),a("p",[t._v("如果有用户数据参与的脚本，需要对数据进行校验。")]),t._v(" "),a("h3",{attrs:{id:"逻辑错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#逻辑错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 逻辑错误")]),t._v(" "),a("p",[t._v("逻辑错误是指软件开发工程师在业务逻辑开发中造成错误。")]),t._v(" "),a("p",[t._v("下面展示一个工程师分析不到位，造成的逻辑错误示例。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("for ($i = 0; $i < 5; $i--) {\n    echo $i;\n}\n")])])]),a("h2",{attrs:{id:"错误报告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误报告","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误报告")]),t._v(" "),a("h3",{attrs:{id:"常见错误类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见错误类型","aria-hidden":"true"}},[t._v("#")]),t._v(" 常见错误类型")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("常量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_ERROR")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("致命的运行时错误。这类错误一般是不可恢复的情况，例如内存分配导致的问题。后果是导致脚本终止不再继续运行")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_WARNING")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("运行时警告 (非致命错误)。仅给出提示信息，但是脚本不会终止运行。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("8")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_NOTICE")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("运行时通知。表示脚本遇到可能会表现为错误的情况。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("64")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_COMPILE_ERROR")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("致命编译时错误。类似 E_ERROR")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("2048")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_STRICT")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("启用 PHP 对代码的修改建议，以确保代码具有最佳的互操作性和向前兼容性。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("8192")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_DEPRECATED")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("运行时通知。启用后将会对在未来版本中可能无法正常工作的代码给出警告。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("8191")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("E_ALL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("所有错误和警告，除级别 E_STRICT 以外。")])])])]),t._v(" "),a("p",[t._v("关闭警告与致命错误")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("error_reporting(~E_WARNING & ~E_COMPILE_ERROR);\nrequire('a');\n")])])]),a("p",[t._v("显示除通知外的所有错误")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("error_reporting(E_ALL & ~E_NOTICE);\necho $houdunren;\n")])])]),a("p",[t._v("关闭错误显示")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("error_reporting(0);\n")])])]),a("h2",{attrs:{id:"处理引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理引擎","aria-hidden":"true"}},[t._v("#")]),t._v(" 处理引擎")]),t._v(" "),a("p",[t._v("通过自定义错误与日志处理引擎，让错误处理个性化。同时有些错误是在用户访问发生的，通过日志可以更全面检测网站运行状态。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<?php\nnamespace Core;\nclass Error\n{\n\t# debug 开启状态\n    protected $debug;\n    public function __construct($debug = true)\n    {\n        $this->debug = $debug;\n    }\n    public function bootstrap()\n    {\n        error_reporting(0);\n        # 自定义错误处理\n        set_error_handler([$this, 'error'], E_ALL | E_STRICT);\n    }\n    public function error($errno, $error, $file, $line)\n    {\n        $msg = $error . \"($errno)\" . $file . \" ($line).\";\n        switch ($errno) {\n            case E_USER_ERROR:\n            case E_USER_NOTICE:\n                break;\n            case E_NOTICE:\n            \t# 开启debug时显示提示消息\n                if ($this->debug)\n                    echo $msg;\n                break;\n            default:\n                if ($this->debug) {\n                    include 'debug.php';\n                } else {\n                    $file =  'logs/' . date('Y_m_d') . '.log';\n                    # 记录错误日志到文件\n                    error_log(date(\"[ c ]\") . $msg . PHP_EOL, 3, $file, null);\n                }\n                die;\n        }\n    }\n}\n(new Error(false))->bootstrap();\ninclude('houdunren.com');\n\n")])])]),a("p",[a("strong",[t._v("错误显示页面")])]),t._v(" "),a("p",[t._v("debug.php用于显示开启debug时的错误显示页面。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">\n</head>\n<body>\n    <div class="container mt-3">\n        <div class="card">\n            <div class="card-header">\n                <?php echo \'File:\' . $file . \'  Line:\' . $line; ?>\n            </div>\n            <div class="card-body p-0">\n                <ul class="list-group list-group-flush">\n                    <?php foreach (debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS) as $id => $f) : ?>\n                        <li class="list-group-item">\n                            <?php echo "#$id " . $f[\'file\'] . "({$f[\'line\']})<br/>"; ?>\n                        </li>\n                    <?php endforeach; ?>\n                </ul>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n')])])])])},[],!1,null,null,null);e.default=r.exports}}]);