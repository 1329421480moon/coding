(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{281:function(e,a,t){"use strict";t.r(a);var n=t(0),s=Object(n.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"异常处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常处理","aria-hidden":"true"}},[e._v("#")]),e._v(" 异常处理")]),e._v(" "),t("blockquote",[t("p",[e._v("创作不易，转载请注明出处： 后盾人 @ houdurnen.com")])]),e._v(" "),t("h2",{attrs:{id:"异常说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常说明","aria-hidden":"true"}},[e._v("#")]),e._v(" 异常说明")]),e._v(" "),t("p",[e._v("异常是推荐的错误处理方式，传统的错误处理方式要判断并一层一层返回到调用点，如下所示：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nclass Code\n{\n    protected $len;\n    public function make(int $len)\n    {\n        $this->len = $len;\n        if ($this->line() === false) {\n            return false;\n        }\n    }\n    public function line()\n    {\n        if ($this->len > 5) {\n            return false;\n        }\n    }\n}\n$code = new Code;\nif ($code->make(10) === false) {\n    echo '验证码创建失败';\n}\n")])])]),t("p",[e._v("通过上面代码我们发布处理错误时及其不方便，需要多个判断语句。下面是改用异常的处理方式。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nclass Code\n{\n    protected $len;\n    public function make(int $len)\n    {\n        $this->len = $len;\n        $this->line();\n    }\n    public function line()\n    {\n        if ($this->len > 5) {\n            throw new Exception('长度不能超过五位');\n        }\n    }\n}\ntry {\n    $code = new Code;\n    $code->make(10);\n} catch (Exception $e) {\n    echo $e->getMessage();\n}\n")])])]),t("h2",{attrs:{id:"基本使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 基本使用")]),e._v(" "),t("h3",{attrs:{id:"try-catch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#try-catch","aria-hidden":"true"}},[e._v("#")]),e._v(" try/catch")]),e._v(" "),t("p",[e._v("PHP需要手动抛出异常，这与其他语言不同，异常使用try...cache触发。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("try{\n\t...\n}catch(){\n\t...\n}\n")])])]),t("p",[e._v("在 "),t("code",[e._v("try")]),e._v(" 代码块中对出现的错误可以抛出异常，下面是手动抛出异常的方法。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("throw new Exception($message,$code)\n")])])]),t("p",[t("code",[e._v("catch")]),e._v(" 用于接收异常，可以设置多个"),t("code",[e._v("catch")]),e._v(" 代码块，参数为 "),t("code",[e._v("Exception")]),e._v(" 类或继承于 "),t("code",[e._v("Exception")]),e._v(" 的类。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nclass ValidateException extends Exception\n{ }\ntry {\n    throw new ValidateException('is exception', 403);\n} catch (ValidateException $e) {\n    echo 'httpException' . $e->getMessage() . ';code:' . $e->getCode();\n} catch (Exception $e) {\n    echo $e->getMessage();\n} finally {\n    echo '无论是否抛出异常都将执行' . ';code:' . $e->getCode();;\n}\n")])])]),t("h3",{attrs:{id:"finally"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#finally","aria-hidden":"true"}},[e._v("#")]),e._v(" finally")]),e._v(" "),t("p",[t("code",[e._v("finally")]),e._v("需要放在 "),t("code",[e._v("catch")]),e._v(" 后，"),t("code",[e._v("finally")]),e._v("无论是否抛出异常都会执行。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("...\n} catch (Exception $e) {\n    echo $e->getMessage();\n} finally {\n    echo '无论是否抛出异常都将执行';\n}\n...\n")])])]),t("h2",{attrs:{id:"异常类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常类","aria-hidden":"true"}},[e._v("#")]),e._v(" 异常类")]),e._v(" "),t("h3",{attrs:{id:"基类方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基类方法","aria-hidden":"true"}},[e._v("#")]),e._v(" 基类方法")]),e._v(" "),t("p",[e._v("PHP为异常处理提供了基础类 "),t("code",[e._v("Exception")]),e._v("，Exception` 类可用方法如下：")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("方法")]),e._v(" "),t("th",[e._v("说明")]),e._v(" "),t("th",[e._v("重写")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("getFile")]),e._v(" "),t("td",[e._v("产生异常错误的文件")]),e._v(" "),t("td",[e._v("NO,final")])]),e._v(" "),t("tr",[t("td",[e._v("getCode")]),e._v(" "),t("td",[e._v("错误码")]),e._v(" "),t("td",[e._v("NO,final")])]),e._v(" "),t("tr",[t("td",[e._v("getLine")]),e._v(" "),t("td",[e._v("错误行号")]),e._v(" "),t("td",[e._v("NO,final")])]),e._v(" "),t("tr",[t("td",[e._v("getMessage")]),e._v(" "),t("td",[e._v("错误消息")]),e._v(" "),t("td",[e._v("NO,final")])]),e._v(" "),t("tr",[t("td",[e._v("__toString")]),e._v(" "),t("td",[e._v("对象转字符串后输出内容")]),e._v(" "),t("td",[e._v("YES")])])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<?php\nclass ValidateException extends Exception\n{\n\t//对象转字符串时执行的魔术方法\n    public function __toString()\n    {\n        return $this->getFile();\n    }\n}\ntry {\n    throw new ValidateException(\'is exception\', 403);\n} catch (ValidateException $e) {\n    echo "文件:" . $e->getFile() . "<hr/>";\n    echo "消息:" . $e->getMessage() . "<hr/>";\n    echo "错误码:" . $e->getCode() . "<hr/>";\n    echo "错误行:" . $e->getLine() . "<hr/>";\n    echo $e . "<hr/>";\n}\n')])])]),t("h3",{attrs:{id:"异常实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异常实例","aria-hidden":"true"}},[e._v("#")]),e._v(" 异常实例")]),e._v(" "),t("p",[e._v("实际开发中需要根据不同业务创建处理错误的异常类，推荐使用异常来处理错误而不是PHP的错误处理机制。")]),e._v(" "),t("p",[e._v("因为代码量比较大，大家请查看视频教程来学习。")]),e._v(" "),t("h2",{attrs:{id:"自定义异常"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义异常","aria-hidden":"true"}},[e._v("#")]),e._v(" 自定义异常")]),e._v(" "),t("p",[e._v("下面是通过实例讲解自定义异常的使用方法。")]),e._v(" "),t("h3",{attrs:{id:"目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录结构","aria-hidden":"true"}},[e._v("#")]),e._v(" 目录结构")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("app\n-- Exceptions\n\t-- ValidateException.php\n\t-- ViewException.php\n-- Servers\n\t-- Validate.php\n\t-- View.php\n-- vendor\n-- view\n\t-- error.blade.php\n\t-- index.blade.php\n\t-- success.blade.php\nbootstrap.php\ncomposer.json\ncontroller.php\nindex.php\n\n")])])]),t("h3",{attrs:{id:"文件内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件内容","aria-hidden":"true"}},[e._v("#")]),e._v(" 文件内容")]),e._v(" "),t("h4",{attrs:{id:"app-exceptions-validateexception-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-exceptions-validateexception-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\Exceptions\\ValidateException.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nnamespace App\\Exceptions;\n\nclass ValidateException extends \\Exception\n{\n    public function render()\n    {\n        $_SESSION['VALIDATE_ERROR'] = '表单参数错误';\n        header('location:index.php');\n    }\n}\n\n")])])]),t("h4",{attrs:{id:"app-exceptions-viewexception-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-exceptions-viewexception-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\Exceptions\\ViewException.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nnamespace App\\Exceptions;\n\nuse App\\Servers\\View;\n\nclass ViewException extends \\Exception\n{\n    public function render()\n    {\n        View::make('error', ['error' => $this->getMessage()]);\n    }\n}\n")])])]),t("h4",{attrs:{id:"app-servers-validate-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-servers-validate-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\Servers\\Validate.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nnamespace App\\Servers;\n\nuse App\\Exceptions\\ValidateException;\n\nclass Validate\n{\n    public static function make()\n    {\n        $_SESSION['VALIDATE_ERROR'] = '';\n        if (empty($_POST['title'])) {\n            throw new ValidateException('表单错误');\n        }\n    }\n}\n")])])]),t("h4",{attrs:{id:"app-servers-view-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-servers-view-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\Servers\\View.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nnamespace App\\Servers;\n\nuse App\\Exceptions\\ViewException;\n\nclass View\n{\n    public static function make(string $tpl, array $vars = [])\n    {\n        $file = 'view/' . $tpl . '.blade.php';\n        if (!is_file($file)) {\n            throw new ViewException($file . '模板不存在');\n        }\n        include $file;\n    }\n}\n")])])]),t("h4",{attrs:{id:"app-view-error-blade-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-view-error-blade-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\view\\error.blade.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>Document</title>\n</head>\n<body>\n    <h1><?php echo $vars[\'error\'];?></h1>\n</body>\n</html>\n')])])]),t("h4",{attrs:{id:"app-view-index-blade-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-view-index-blade-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\view\\index.blade.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<?php if(isset($_SESSION[\'VALIDATE_ERROR\'])):?>\n<?php echo $_SESSION[\'VALIDATE_ERROR\'];?>\n<?php endif;?>\n    <form method="post" action="controller.php">\n        <input type="text" name="title">\n        <button>提交</button>\n    </form>\n')])])]),t("h4",{attrs:{id:"app-view-error-blade-php-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-view-error-blade-php-2","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\view\\error.blade.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<h1>操作成功</h1>\n")])])]),t("h4",{attrs:{id:"app-bootstrap-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-bootstrap-php","aria-hidden":"true"}},[e._v("#")]),e._v(" app\\bootstrap.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nsession_start();\ninclude 'vendor/autoload.php';\nclass Boot\n{\n    public function init()\n    {\n        set_exception_handler([$this, 'exception']);\n    }\n    public function exception($e)\n    {\n        if (method_exists($e, 'render')) {\n            $e->render();\n        }\n    }\n}\n(new Boot)->init();\n")])])]),t("h4",{attrs:{id:"composer-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#composer-json","aria-hidden":"true"}},[e._v("#")]),e._v(" composer.json")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('{\n    "name": "hd/app",\n    "authors": [\n        {\n            "name": "houdunren.com",\n            "email": "2300071698@qq.com"\n        }\n    ],\n    "autoload": {\n        "psr-4": {\n            "App\\\\": "."\n        }\n    },\n    "require": {}\n}\n')])])]),t("h4",{attrs:{id:"controller-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#controller-php","aria-hidden":"true"}},[e._v("#")]),e._v(" controller.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\ninclude 'bootstrap.php';\nuse App\\Servers\\Validate;\nuse App\\Servers\\View;\n\ninclude 'vendor/autoload.php';\n// try {\nValidate::make();\nView::make('success');\n// } catch (ValidateException $e) {\n//     $e->render();\n// } catch (ViewException $e) {\n//     $e->render();\n// }\n\n")])])]),t("h4",{attrs:{id:"index-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#index-php","aria-hidden":"true"}},[e._v("#")]),e._v(" index.php")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\nnamespace App;\n\ninclude 'bootstrap.php';\nuse App\\Servers\\View;\n\nView::make('index');\n")])])])])},[],!1,null,null,null);a.default=s.exports}}]);