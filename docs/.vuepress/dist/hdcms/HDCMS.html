<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>软件安装 | 后盾人</title>
    <meta name="description" content="在线文档库">
    
    
    <link rel="preload" href="/code/assets/css/0.styles.fcb1d57d.css" as="style"><link rel="preload" href="/code/assets/js/app.bca2b3d0.js" as="script"><link rel="preload" href="/code/assets/js/2.981a9de6.js" as="script"><link rel="preload" href="/code/assets/js/12.a8a0da58.js" as="script"><link rel="prefetch" href="/code/assets/js/10.a80187a9.js"><link rel="prefetch" href="/code/assets/js/11.73e0c7ef.js"><link rel="prefetch" href="/code/assets/js/13.d78db245.js"><link rel="prefetch" href="/code/assets/js/14.2701c7ee.js"><link rel="prefetch" href="/code/assets/js/15.3731fe8d.js"><link rel="prefetch" href="/code/assets/js/16.cccb1964.js"><link rel="prefetch" href="/code/assets/js/17.e5012aba.js"><link rel="prefetch" href="/code/assets/js/18.12da54a5.js"><link rel="prefetch" href="/code/assets/js/19.73b7fa43.js"><link rel="prefetch" href="/code/assets/js/20.46b91d6b.js"><link rel="prefetch" href="/code/assets/js/21.e2a46793.js"><link rel="prefetch" href="/code/assets/js/22.eff1a377.js"><link rel="prefetch" href="/code/assets/js/23.23839513.js"><link rel="prefetch" href="/code/assets/js/24.2947ae10.js"><link rel="prefetch" href="/code/assets/js/25.d7784a74.js"><link rel="prefetch" href="/code/assets/js/26.a4779340.js"><link rel="prefetch" href="/code/assets/js/27.e6ac6cf6.js"><link rel="prefetch" href="/code/assets/js/28.8dbfd7da.js"><link rel="prefetch" href="/code/assets/js/29.52e7f28b.js"><link rel="prefetch" href="/code/assets/js/3.5c8057d9.js"><link rel="prefetch" href="/code/assets/js/30.0bc3e9a7.js"><link rel="prefetch" href="/code/assets/js/31.72fd5fdd.js"><link rel="prefetch" href="/code/assets/js/32.da4abfea.js"><link rel="prefetch" href="/code/assets/js/33.7b816751.js"><link rel="prefetch" href="/code/assets/js/34.8e7da4bc.js"><link rel="prefetch" href="/code/assets/js/35.92e12cd2.js"><link rel="prefetch" href="/code/assets/js/36.c7d0b613.js"><link rel="prefetch" href="/code/assets/js/37.e449b9ce.js"><link rel="prefetch" href="/code/assets/js/38.0cb50ad7.js"><link rel="prefetch" href="/code/assets/js/39.a522b15e.js"><link rel="prefetch" href="/code/assets/js/4.523d56bd.js"><link rel="prefetch" href="/code/assets/js/40.60a1c2e9.js"><link rel="prefetch" href="/code/assets/js/41.6e042fe8.js"><link rel="prefetch" href="/code/assets/js/42.07e10eb3.js"><link rel="prefetch" href="/code/assets/js/43.402e7456.js"><link rel="prefetch" href="/code/assets/js/44.a5459a22.js"><link rel="prefetch" href="/code/assets/js/45.aedf13f7.js"><link rel="prefetch" href="/code/assets/js/46.ff58a42c.js"><link rel="prefetch" href="/code/assets/js/47.8413bced.js"><link rel="prefetch" href="/code/assets/js/48.40fd4e3d.js"><link rel="prefetch" href="/code/assets/js/49.1358bea7.js"><link rel="prefetch" href="/code/assets/js/5.69242544.js"><link rel="prefetch" href="/code/assets/js/50.2a32cb2f.js"><link rel="prefetch" href="/code/assets/js/51.8018c74c.js"><link rel="prefetch" href="/code/assets/js/52.2c4bfe2d.js"><link rel="prefetch" href="/code/assets/js/53.97b3c978.js"><link rel="prefetch" href="/code/assets/js/54.7674e5b7.js"><link rel="prefetch" href="/code/assets/js/55.9f385dd8.js"><link rel="prefetch" href="/code/assets/js/56.1fd05224.js"><link rel="prefetch" href="/code/assets/js/57.17dbac44.js"><link rel="prefetch" href="/code/assets/js/58.2928ef92.js"><link rel="prefetch" href="/code/assets/js/59.4374057e.js"><link rel="prefetch" href="/code/assets/js/6.85d87b30.js"><link rel="prefetch" href="/code/assets/js/60.1103a418.js"><link rel="prefetch" href="/code/assets/js/7.f93228a2.js"><link rel="prefetch" href="/code/assets/js/8.fcbd293b.js"><link rel="prefetch" href="/code/assets/js/9.708803d7.js">
    <link rel="stylesheet" href="/code/assets/css/0.styles.fcb1d57d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/code/" class="home-link router-link-active"><!----> <span class="site-name">后盾人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/code/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/code/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/code/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/code/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/code/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/code/hdcms/HDCMS.html" class="nav-link router-link-exact-active router-link-active">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/code/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/code/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/code/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/code/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/code/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/code/hdcms/HDCMS.html" class="nav-link router-link-exact-active router-link-active">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/code/hdcms/HDCMS.html" class="active sidebar-link">hdcms</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#软件安装" class="sidebar-link">软件安装</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#服务器配置" class="sidebar-link">服务器配置</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#设置访问目录" class="sidebar-link">设置访问目录</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#开启404" class="sidebar-link">开启404</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#常用函数" class="sidebar-link">常用函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#route-class" class="sidebar-link">route_class</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#issuperadmin" class="sidebar-link">isSuperAdmin</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#module-access" class="sidebar-link">module_access</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#site" class="sidebar-link">site</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#module" class="sidebar-link">module</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#tableforeign" class="sidebar-link">tableForeign</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#系统管理" class="sidebar-link">系统管理</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#站点管理" class="sidebar-link">站点管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#站点配置" class="sidebar-link">站点配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#模块开发" class="sidebar-link">模块开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#生成链接" class="sidebar-link">生成链接</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#域名访问" class="sidebar-link">域名访问</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#微信公众号" class="sidebar-link">微信公众号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#模块配置" class="sidebar-link">模块配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#前端组件" class="sidebar-link">前端组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#面包屑导航" class="sidebar-link">面包屑导航</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#图片上传" class="sidebar-link">图片上传</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#文件上传" class="sidebar-link">文件上传</a></li><li class="sidebar-sub-header"><a href="/code/hdcms/HDCMS.html#函数库" class="sidebar-link">函数库</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="软件安装"><a href="#软件安装" aria-hidden="true" class="header-anchor">#</a> 软件安装</h2> <h2 id="服务器配置"><a href="#服务器配置" aria-hidden="true" class="header-anchor">#</a> 服务器配置</h2> <p>下面是宝塔面板为例进行说明</p> <h2 id="设置访问目录"><a href="#设置访问目录" aria-hidden="true" class="header-anchor">#</a> 设置访问目录</h2> <p>将网站运行目录指向到 <code>public</code></p> <p><img src="/code/assets/img/image-20190224213349903-1015229.873c6879.png" alt="image-20190224213349903"></p> <h2 id="开启404"><a href="#开启404" aria-hidden="true" class="header-anchor">#</a> 开启404</h2> <p>注释掉以下网站配置项，可以开启Laravel Router 404。（如果你想使用服务器的404页面，就不需要设置了）</p> <div class="language- extra-class"><pre class="language-text"><code>#error_page 404 /404.html;
</code></pre></div><p><img src="/code/assets/img/image-20190224213416204-1015256.3fc68853.png" alt="image-20190224213416204"></p> <h2 id="中间件"><a href="#中间件" aria-hidden="true" class="header-anchor">#</a> 中间件</h2> <table><thead><tr><th>中间件</th> <th>说明</th></tr></thead> <tbody><tr><td>modue</td> <td>加载站点与模块数据。后台模块开发时必须使用。</td></tr></tbody></table> <h2 id="常用函数"><a href="#常用函数" aria-hidden="true" class="header-anchor">#</a> 常用函数</h2> <h3 id="route-class"><a href="#route-class" aria-hidden="true" class="header-anchor">#</a> route_class</h3> <p>根据路由生成以 <code>-</code> 分隔的css样式名称</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 根据路由设置样式类
 * @return string|null
 */
function route_class()
</code></pre></div><h3 id="issuperadmin"><a href="#issuperadmin" aria-hidden="true" class="header-anchor">#</a> isSuperAdmin</h3> <p>超级管理员检测</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 超级管理员检测
 * @return bool
 */
function isSuperAdmin(): bool
</code></pre></div><h3 id="module-access"><a href="#module-access" aria-hidden="true" class="header-anchor">#</a> module_access</h3> <p>模块权限判断</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 模块权限判断
 * @param string $permission 权限标识
 * @param string|null $module 模块标识
 * @param bool $abort 验证失败时显示错误页面
 * @return mixed
 * @throws Exception
 */
function module_access(string $permission, string $module = null, $abort = false)
</code></pre></div><h3 id="site"><a href="#site" aria-hidden="true" class="header-anchor">#</a> site</h3> <p>获取当前站点对象，只在后台站点管理和前台有效。</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 保存或获取当前站点
 * @param \App\Models\Site|null $site 站点模型
 * @return \App\Models\Site
 */
function site(\App\Models\Site $site = null): ?\App\Models\Site
</code></pre></div><h3 id="module"><a href="#module" aria-hidden="true" class="header-anchor">#</a> module</h3> <p>获取当前使用的模块对象，只在后台站点管理和前台有效。</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 保存或获取当前模块
 * @param \App\Models\Module $module 模型对象
 * @return \App\Models\Module|null
 */
function module(\App\Models\Module $module = null): ?\App\Models\Module
</code></pre></div><h3 id="tableforeign"><a href="#tableforeign" aria-hidden="true" class="header-anchor">#</a> tableForeign</h3> <p>函数用于实现表关联的外键约束。</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 表外键关联约束
 * @param Illuminate\Database\Schema\Blueprint $table Blueprint 迁移对象(直接传递迁移文件中的$table)
 * @param string $tableName 关联表
 * @param string $foreignKey 关联字段
 */
function tableForeign(\Illuminate\Database\Schema\Blueprint $table, string $tableName, string $foreignKey): void
</code></pre></div><h2 id="系统管理"><a href="#系统管理" aria-hidden="true" class="header-anchor">#</a> 系统管理</h2> <h4 id="系统配置"><a href="#系统配置" aria-hidden="true" class="header-anchor">#</a> 系统配置</h4> <p>系统配置主要是影响后台系统管理</p> <p><img src="/code/assets/img/image-20190224214207819-1015727.a36ac205.png" alt="image-20190224214207819"></p> <p>获取系统配置如下（系统变量可以后台查看）</p> <div class="language- extra-class"><pre class="language-text"><code>{{config_get('变量名','默认值','system')}}
</code></pre></div><h2 id="站点管理"><a href="#站点管理" aria-hidden="true" class="header-anchor">#</a> 站点管理</h2> <h3 id="站点配置"><a href="#站点配置" aria-hidden="true" class="header-anchor">#</a> 站点配置</h3> <p>每个站点拥有独立的配置项。</p> <p><img src="assets/image-20190224214024168.png" alt="image-20190224214024168"></p> <p>使用以下方式获取站点配置</p> <div class="language- extra-class"><pre class="language-text"><code>{{config_get('变量名','默认值','site')}}
</code></pre></div><h2 id="模块开发"><a href="#模块开发" aria-hidden="true" class="header-anchor">#</a> 模块开发</h2> <h3 id="生成链接"><a href="#生成链接" aria-hidden="true" class="header-anchor">#</a> 生成链接</h3> <p>使用 <code>module_link</code> 函数可以方便的生成模块链接，函数会添加 <code>sid</code> 站点编号与 <code>mid</code> 模块编号。</p> <div class="language- extra-class"><pre class="language-text"><code>module_link(路由，路由参数)
</code></pre></div><p>也可以使用系统 route()函数生成路由，但需要手动添加 <code>sid</code> 与 <code>mid</code> 参数</p> <div class="language- extra-class"><pre class="language-text"><code>route(路由，['sid'=&gt;site()['id'],'mid'=&gt;module()['mid']])
</code></pre></div><h3 id="域名访问"><a href="#域名访问" aria-hidden="true" class="header-anchor">#</a> 域名访问</h3> <p><strong>配置域名</strong></p> <p>在模块设计时开启 <code>系统菜单&gt;域名管理</code>  选项后，在站点管理下就有模块域名设置菜单了。</p> <p><img src="assets/image-20190224004751501-0940471.png" alt="image-20190224004751501"></p> <p><strong>域名访问</strong></p> <p>使用域名会访问到模块的 <code>SystemController</code> 控制器的 <code>domain</code> 方法</p> <h2 id="微信公众号"><a href="#微信公众号" aria-hidden="true" class="header-anchor">#</a> 微信公众号</h2> <p>对微信公众号的支持我们提供了非常丰富的功能。</p> <h3 id="模块配置"><a href="#模块配置" aria-hidden="true" class="header-anchor">#</a> 模块配置</h3> <h4 id="数据表"><a href="#数据表" aria-hidden="true" class="header-anchor">#</a> 数据表</h4> <p>执行 <code>artisan module:make-migration News Shop</code>在 <code>Shop</code> 模块中创建数据表 <code>News</code> ，并且数据表必须存在 <code>site_id</code> 与 <code>module_id</code> 字段</p> <div class="language- extra-class"><pre class="language-text"><code>Schema::create('news', function (Blueprint $table) {
	$table-&gt;increments('id');
	$table-&gt;string('content')-&gt;comment('回复的文本内容');
	tableForeign($table, 'sites', 'site_id');
	tableForeign($table, 'modules', 'module_id');
	$table-&gt;timestamps();
});
</code></pre></div><h4 id="模型"><a href="#模型" aria-hidden="true" class="header-anchor">#</a> 模型</h4> <p>使用 <code>artisan module:make-model News Shop</code> 在 <code>Shop</code> 模块中创建模型<code>News</code> ,并在模型中创建与微信关键词表的关联的函数。</p> <div class="language- extra-class"><pre class="language-text"><code>public function keyword()
{
	return $this-&gt;morphOne(Keyword::class, 'model');
}
</code></pre></div><h4 id="控制器"><a href="#控制器" aria-hidden="true" class="header-anchor">#</a> 控制器</h4> <div class="language- extra-class"><pre class="language-text"><code>...
class TextController extends Controller
{
	public function create(Text $text)
	{
        return view('module.text.create',compact('text'));
	}
	
	public function store(Request $request, ChatServer $server)
	{
        $data = $request-&gt;input();
        $data['site_id'] = site()['id'];
        $data['module_id'] = module()['id'];

        //保存微信数据
        \DB::beginTransaction();
        $server-&gt;save(Text::create($data));
        \DB::commit();
        return redirect(module_link('module.text.index'))-&gt;with('success', '保存成功');
	}

	public function edit(Text $text)
	{
        return view('module.text.edit', compact('text'));
	}

	public function update(Request $request, Text $text, ChatServer $server)
	{
        \DB::beginTransaction();
        $text-&gt;update($request-&gt;input());
        $server-&gt;save($text);
        \DB::commit();
        return redirect(module_link('module.text.index'))-&gt;with('success', '保存成功');
	}

	public function destroy(Text $text)
	{
        \DB::transaction(function () use ($text) {
            $text-&gt;keyword-&gt;delete();
            $text-&gt;delete();
        });
        return back()-&gt;with('success', '删除成功');
	}
}
</code></pre></div><h4 id="视图"><a href="#视图" aria-hidden="true" class="header-anchor">#</a> 视图</h4> <p><code>components.keyword</code> 为关键词组件。<code>tag</code> 关键词标签（模块可以根据tag做不同处理方式）,<code>model</code> 为数据模型执行新增方法时传递空模型。</p> <div class="language- extra-class"><pre class="language-text"><code>@extends('layouts.module')
@section('content')
    &lt;form action=&quot;{{module_link('module.text.store')}}&quot; method=&quot;post&quot;&gt;
        @csrf
		@include('components.keyword',['tag'=&gt;'text','model'=&gt;$text])
		...
		添加到模型的表单的，关键词的表单系统会自动处理
    &lt;/form&gt;
@endsection
</code></pre></div><h2 id="前端组件"><a href="#前端组件" aria-hidden="true" class="header-anchor">#</a> 前端组件</h2> <h3 id="面包屑导航"><a href="#面包屑导航" aria-hidden="true" class="header-anchor">#</a> 面包屑导航</h3> <div class="language- extra-class"><pre class="language-text"><code>@include('components.breadcrumb',['menus'=&gt;['微信普通文本消息'=&gt;'#']])
</code></pre></div><p><img src="assets/image-20190226215812661-1189492.png" alt="image-20190226215812661"></p> <h3 id="图片上传"><a href="#图片上传" aria-hidden="true" class="header-anchor">#</a> 图片上传</h3> <p>使用 <code>uploadImage</code> 函数上传图片，参数为input表单的name值。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;div class=&quot;form-group&quot;&gt;
	&lt;label&gt;图片上传&lt;/label&gt;
	&lt;div class=&quot;input-group mb-1&quot;&gt;
		&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;icon&quot; value=&quot;&quot;&gt;
		&lt;div class=&quot;input-group-append&quot;&gt;
		&lt;button class=&quot;btn btn-outline-secondary&quot; onclick=&quot;uploadImage('icon')&quot; type=&quot;button&quot;&gt;
			选择图标
		&lt;/button&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;img class=&quot;img-thumbnail d-block&quot; src=&quot;&quot;&gt;
&lt;/div&gt;
</code></pre></div><h3 id="文件上传"><a href="#文件上传" aria-hidden="true" class="header-anchor">#</a> 文件上传</h3> <p>使用 <code>uploadFile</code> 函数上传文件，参数1为input表单的name值，参数2为上传类型（不设置时使用系统配置项）</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;div class=&quot;form-group&quot;&gt;
	&lt;label&gt;文件上传&lt;/label&gt;
	&lt;div class=&quot;input-group mb-1&quot;&gt;
		&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;icon&quot; value=&quot;&quot;&gt;
		&lt;div class=&quot;input-group-append&quot;&gt;
		&lt;button class=&quot;btn btn-outline-secondary&quot; onclick=&quot;uploadFile('icon')&quot; type=&quot;button&quot;&gt;
			选择文件
		&lt;/button&gt;
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;
</code></pre></div><h3 id="函数库"><a href="#函数库" aria-hidden="true" class="header-anchor">#</a> 函数库</h3> <h4 id="destroy"><a href="#destroy" aria-hidden="true" class="header-anchor">#</a> destroy</h4> <p>用于触发删除资源使用的前端脚本</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 删除事件
 * @param bt 按钮
 * @param message 提示消息
 */
function destroy(bt, message) {
</code></pre></div><p>使用代码如下，注意 <code>form</code> 必须在按钮前面</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;form action=&quot;{{route('site.chat.destroy',[$site,$chat])}}&quot; method=&quot;post&quot;&gt;
	@csrf @method('DELETE')
&lt;/form&gt;
&lt;button type=&quot;button&quot; onclick=&quot;destroy(this,'确定删除 {{$chat['name']}} 公众号吗？')&quot;&gt;
	删除公众号
&lt;/button&gt;
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/houdunwang/coding/edit/master/docs/hdcms/HDCMS.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/6/2019, 8:21:38 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/code/assets/js/app.bca2b3d0.js" defer></script><script src="/code/assets/js/2.981a9de6.js" defer></script><script src="/code/assets/js/12.a8a0da58.js" defer></script>
  </body>
</html>
