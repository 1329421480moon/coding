<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Api | 后盾人</title>
    <meta name="description" content="在线文档库">
    
    
    <link rel="preload" href="/assets/css/0.styles.111cf423.css" as="style"><link rel="preload" href="/assets/js/app.78ae37e1.js" as="script"><link rel="preload" href="/assets/js/2.17f01c05.js" as="script"><link rel="preload" href="/assets/js/4.ab422658.js" as="script"><link rel="prefetch" href="/assets/js/10.4b75243f.js"><link rel="prefetch" href="/assets/js/11.84c80354.js"><link rel="prefetch" href="/assets/js/12.c29a6e8d.js"><link rel="prefetch" href="/assets/js/13.128e399a.js"><link rel="prefetch" href="/assets/js/14.fed2ba43.js"><link rel="prefetch" href="/assets/js/15.dc05f291.js"><link rel="prefetch" href="/assets/js/16.6cb5eedf.js"><link rel="prefetch" href="/assets/js/17.5220c952.js"><link rel="prefetch" href="/assets/js/18.56009153.js"><link rel="prefetch" href="/assets/js/19.9efbf90b.js"><link rel="prefetch" href="/assets/js/20.473c2456.js"><link rel="prefetch" href="/assets/js/21.6b8de9b3.js"><link rel="prefetch" href="/assets/js/22.886e6515.js"><link rel="prefetch" href="/assets/js/23.9090b603.js"><link rel="prefetch" href="/assets/js/24.7db1b5a2.js"><link rel="prefetch" href="/assets/js/25.64ecf20f.js"><link rel="prefetch" href="/assets/js/26.b075a069.js"><link rel="prefetch" href="/assets/js/27.e51f00b9.js"><link rel="prefetch" href="/assets/js/28.7883e053.js"><link rel="prefetch" href="/assets/js/29.56b9e1a8.js"><link rel="prefetch" href="/assets/js/3.35e62763.js"><link rel="prefetch" href="/assets/js/30.497ffb38.js"><link rel="prefetch" href="/assets/js/31.d6afce7b.js"><link rel="prefetch" href="/assets/js/32.42e88601.js"><link rel="prefetch" href="/assets/js/33.01cedb04.js"><link rel="prefetch" href="/assets/js/34.21cc23fe.js"><link rel="prefetch" href="/assets/js/35.e9483036.js"><link rel="prefetch" href="/assets/js/36.4f1832b1.js"><link rel="prefetch" href="/assets/js/37.be8a9e75.js"><link rel="prefetch" href="/assets/js/38.e570c837.js"><link rel="prefetch" href="/assets/js/39.3dfe4f1d.js"><link rel="prefetch" href="/assets/js/40.5e5dcd95.js"><link rel="prefetch" href="/assets/js/41.379fcead.js"><link rel="prefetch" href="/assets/js/42.b4056331.js"><link rel="prefetch" href="/assets/js/43.8f756fb7.js"><link rel="prefetch" href="/assets/js/44.53ae548e.js"><link rel="prefetch" href="/assets/js/45.cda13560.js"><link rel="prefetch" href="/assets/js/46.a38ff3a3.js"><link rel="prefetch" href="/assets/js/47.9059421f.js"><link rel="prefetch" href="/assets/js/48.506c224f.js"><link rel="prefetch" href="/assets/js/49.0f04d06b.js"><link rel="prefetch" href="/assets/js/5.1743bbc0.js"><link rel="prefetch" href="/assets/js/50.b96d8735.js"><link rel="prefetch" href="/assets/js/51.fc13c11c.js"><link rel="prefetch" href="/assets/js/52.7cd5eda0.js"><link rel="prefetch" href="/assets/js/53.10766352.js"><link rel="prefetch" href="/assets/js/54.4dea17ec.js"><link rel="prefetch" href="/assets/js/55.1a21cb35.js"><link rel="prefetch" href="/assets/js/56.fcdc95bc.js"><link rel="prefetch" href="/assets/js/57.b87ad411.js"><link rel="prefetch" href="/assets/js/58.313cbdd1.js"><link rel="prefetch" href="/assets/js/59.b9619749.js"><link rel="prefetch" href="/assets/js/6.549c23be.js"><link rel="prefetch" href="/assets/js/60.fda5811b.js"><link rel="prefetch" href="/assets/js/7.60340cfe.js"><link rel="prefetch" href="/assets/js/8.3c0e1849.js"><link rel="prefetch" href="/assets/js/9.b50ee994.js">
    <link rel="stylesheet" href="/assets/css/0.styles.111cf423.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">后盾人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/hdcms/HDCMS.html" class="nav-link">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/hdcms/HDCMS.html" class="nav-link">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/laravel/package.html" class="sidebar-link">开发扩展包</a></li><li><a href="/laravel/API.html" class="active sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel/API.html#api" class="sidebar-link">Api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel/API.html#动作" class="sidebar-link">动作</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#命名" class="sidebar-link">命名</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#版本" class="sidebar-link">版本</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#过滤" class="sidebar-link">过滤</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#状态码" class="sidebar-link">状态码</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#响应格式" class="sidebar-link">响应格式</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel/API.html#postman" class="sidebar-link">Postman</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel/API.html#环境变量" class="sidebar-link">环境变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel/API.html#dingo" class="sidebar-link">Dingo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel/API.html#安装组件" class="sidebar-link">安装组件</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#配置说明" class="sidebar-link">配置说明</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#接口版本" class="sidebar-link">接口版本</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#基础控制器" class="sidebar-link">基础控制器</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#transformers" class="sidebar-link">Transformers</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#响应结果" class="sidebar-link">响应结果</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#限制请求数" class="sidebar-link">限制请求数</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#身份验证" class="sidebar-link">身份验证</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel/API.html#jwt" class="sidebar-link">Jwt</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel/API.html#安装组件-2" class="sidebar-link">安装组件</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#配置说明-2" class="sidebar-link">配置说明</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#更新用户模型" class="sidebar-link">更新用户模型</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#配置验证守卫" class="sidebar-link">配置验证守卫</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#验证操作" class="sidebar-link">验证操作</a></li><li class="sidebar-sub-header"><a href="/laravel/API.html#使用令牌" class="sidebar-link">使用令牌</a></li></ul></li></ul></li><li><a href="/laravel/algolia.html" class="sidebar-link">algolia</a></li><li><a href="/laravel/package.html" class="sidebar-link">开发扩展包</a></li><li><a href="/laravel/使用技巧.html" class="sidebar-link">使用技巧</a></li><li><a href="/laravel/Laravel.html" class="sidebar-link">Laravel</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> Api</h2> <blockquote><p>创作不易，转载请注明出处： 后盾人 @ houdurnen.com</p></blockquote> <p>REST是所有Web应用都应该遵守的架构设计指导原则。  Representational State Transfer，翻译是”表现层状态转化”。</p> <p>面向资源是REST最明显的特征，对于同一个资源的一组不同的操作。资源是服务器上一个可命名的抽象概念，资源是以名词为核心来组织的，首先关注的是名词。REST要求，必须通过统一的接口来对资源执行各种操作。对于每个资源只能执行一组有限的操作。</p> <h3 id="动作"><a href="#动作" aria-hidden="true" class="header-anchor">#</a> 动作</h3> <div class="language- extra-class"><pre class="language-text"><code>GET （SELECT）：从服务器检索特定资源，或资源列表
POST （CREATE）：在服务器上创建一个新的资源
PUT （UPDATE）：更新服务器上的资源，提供整个资源
PATCH （UPDATE）：更新服务器上的资源，仅提供更改的属性
DELETE （DELETE）：从服务器删除资源
</code></pre></div><h3 id="命名"><a href="#命名" aria-hidden="true" class="header-anchor">#</a> 命名</h3> <p>路径又称&quot;终点&quot;（endpoint），表示API的具体网址。</p> <p>在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词，而且所用的名词往往与数据库的表名对应。一般来说，数据库中的表都是同种记录的&quot;集合&quot;（collection），所以API中的名词也应该使用复数。</p> <p>举例来说，有一个API提供动物园（zoo）的信息，还包括各种动物和雇员的信息，则它的路径应该设计成下面这样。</p> <p>接口尽量使用名词，禁止使用动词，下面是一些例子。</p> <div class="language- extra-class"><pre class="language-text"><code>GET         /zoos：列出所有动物园
POST        /zoos：新建一个动物园
GET         /zoos/ID：获取某个指定动物园的信息
PUT         /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）
PATCH       /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）
DELETE      /zoos/ID：删除某个动物园
GET         /zoos/ID/animals：列出某个指定动物园的所有动物
DELETE      /zoos/ID/animals/ID：删除某个指定动物园的指定动物
</code></pre></div><p>再比如，某个URI是/posts/show/1，其中show是动词，这个URI就设计错了，正确的写法应该是/posts/1，然后用GET方法表示show。</p> <h3 id="版本"><a href="#版本" aria-hidden="true" class="header-anchor">#</a> 版本</h3> <p>应该将API的版本号放入URL。如：</p> <div class="language- extra-class"><pre class="language-text"><code>https://api.example.com/v1
</code></pre></div><h3 id="过滤"><a href="#过滤" aria-hidden="true" class="header-anchor">#</a> 过滤</h3> <p>如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。
下面是一些常见的参数。</p> <div class="language- extra-class"><pre class="language-text"><code>?limit=10：指定返回记录的数量
?offset=10：指定返回记录的开始位置。
?page_number=2&amp;page_size=100：指定第几页，以及每页的记录数。
?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。
?animal_type_id=1：指定筛选条件
</code></pre></div><h3 id="状态码"><a href="#状态码" aria-hidden="true" class="header-anchor">#</a> 状态码</h3> <div class="language- extra-class"><pre class="language-text"><code>200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。
201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。
202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）
204 NO CONTENT - [DELETE]：用户删除数据成功。
400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作
401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。
403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。
404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。
406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。
410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。
422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。
429 Too Many Requests - 由于请求频次达到上限而被拒绝访问
500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。
</code></pre></div><h3 id="响应格式"><a href="#响应格式" aria-hidden="true" class="header-anchor">#</a> 响应格式</h3> <p>从可读性和通用性来讲 <code>JSON</code> 是最好的响应数据格式，下面是一个错误消息响应数据结构。</p> <div class="language- extra-class"><pre class="language-text"><code>{   
	'message' =&gt; ':message',
	'errors' =&gt; ':errors',
	'code' =&gt; ':code',
	'status_code' =&gt; ':status_code',
	'debug' =&gt; ':debug'
}
</code></pre></div><ul><li>message：表示在API调用失败的情况下详细的错误信息，这个信息可以由客户端直接呈现给用户</li> <li>errors：参数具体错误，比如字段较对错误内容</li> <li>code：自定义错误码</li> <li>status_code：http状态码</li> <li>debug：debug调试信息</li></ul> <blockquote><p>错误返回值根据情况进行删减</p></blockquote> <h2 id="postman"><a href="#postman" aria-hidden="true" class="header-anchor">#</a> Postman</h2> <p>postman可以高效的测试和维护接口。https://www.getpostman.com/apps</p> <p><img src="/assets/img/image-20180628123448463.73c98873.png" alt="image-20180628123448463"></p> <p><img src="/assets/img/image-20180628123556704.08640e82.png" alt="image-20180628123556704"></p> <p>使用 <code>postMan</code> 工具测试结果</p> <p><img src="/assets/img/image-20180628122441329.fa0f1010.png" alt="image-20180628122441329"></p> <h3 id="环境变量"><a href="#环境变量" aria-hidden="true" class="header-anchor">#</a> 环境变量</h3> <p>我们在本地和服务器上都想测试接口，可以将域名定义为环境变量，这样我们只要改变环境域名就会自动变化。</p> <p><img src="/assets/img/image-20180628124151269.df557d32.png" alt="image-20180628124151269"></p> <p><img src="/assets/img/image-20180628124248502.085fd7de.png" alt="image-20180628124248502"></p> <p><img src="/assets/img/image-20180628124449686.12828631.png" alt="image-20180628124449686"></p> <h2 id="dingo"><a href="#dingo" aria-hidden="true" class="header-anchor">#</a> Dingo</h2> <p>Dingo Api 是致力于提供给开发者一套工具，帮助你方便快捷的建造你自己的API。这个包的目标是保持尽可能的灵活，它并不能覆盖所有的情况，也不能解决所有的问题。</p> <p>官网：https://github.com/dingo/api/</p> <p>文档：https://github.com/dingo/api/wiki/Configuration</p> <h3 id="安装组件"><a href="#安装组件" aria-hidden="true" class="header-anchor">#</a> 安装组件</h3> <div class="language- extra-class"><pre class="language-text"><code>composer require dingo/api:2.0.0-alpha2
</code></pre></div><p>执行下面命令生成配置文件 <code>/config/api.php</code></p> <div class="language- extra-class"><pre class="language-text"><code>php artisan vendor:publish
</code></pre></div><h3 id="配置说明"><a href="#配置说明" aria-hidden="true" class="header-anchor">#</a> 配置说明</h3> <p>配置统一定义在 <code>config/api.php</code> 文档中</p> <div class="language- extra-class"><pre class="language-text"><code>#接口围绕：[x]本地和私有环境 [prs]公司内部app使用 [vnd]公开接口
'standardsTree' =&gt; env('API_STANDARDS_TREE', 'x')

#项目名称
'subtype' =&gt; env('API_SUBTYPE', 'hdcms')

#Api前缀 通过 www.hdcms.com/api 来访问 API。
'prefix' =&gt; env('API_PREFIX', 'api')

#api域名
'domain' =&gt; env('API_DOMAIN', 'api.hdcms.com'),

#版本号
'version' =&gt; env('API_VERSION', 'v1')

#开发时开启DEBUG便于发现错误
'debug' =&gt; env('API_DEBUG', false)
</code></pre></div><blockquote><p>prefix 与 domain 只能二选一</p></blockquote> <h3 id="接口版本"><a href="#接口版本" aria-hidden="true" class="header-anchor">#</a> 接口版本</h3> <p>在 <code>routes/api.php</code> 文件定义</p> <div class="language- extra-class"><pre class="language-text"><code>$api = app(\Dingo\Api\Routing\Router::class);

#默认配置指定的是v1版本，可以直接通过 {host}/api/version 访问到
$api-&gt;version('v1', function ($api) {
    $api-&gt;get('version', function () {
        return 'v1';
    });
});

#如果v2不是默认版本，需要设置请求头  
#Accept: application/[配置项 standardsTree].[配置项 subtype].v2+json
$api-&gt;version('v2', function ($api) {
    $api-&gt;get('version', function () {
        return 'v2';
    });
});
</code></pre></div><h3 id="基础控制器"><a href="#基础控制器" aria-hidden="true" class="header-anchor">#</a> 基础控制器</h3> <div class="language- extra-class"><pre class="language-text"><code>php artisan make:controller Api/Controller
</code></pre></div><p>修改内容如下</p> <div class="language- extra-class"><pre class="language-text"><code>namespace App\Http\Controllers\Api;

use Dingo\Api\Routing\Helpers;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller as SysController;

class Controller extends SysController
{
    use Helpers;
}
</code></pre></div><h3 id="transformers"><a href="#transformers" aria-hidden="true" class="header-anchor">#</a> Transformers</h3> <p>Transformers 允许你便捷地、始终如一地将对象转换为一个数组。通过使用一个 transformer 你可以对整数和布尔值，包括分页结果和嵌套关系进行类型转换。</p> <h4 id="基本使用"><a href="#基本使用" aria-hidden="true" class="header-anchor">#</a> 基本使用</h4> <p>一个 <strong>transformer</strong> 是一个类，它会获取原始数据并将返回一个格式化之后的标准数组。</p> <div class="language- extra-class"><pre class="language-text"><code>namespace App\Transformers;

use App\User;
use League\Fractal\TransformerAbstract;

class UserTransformer extends TransformerAbstract
{
    public function transform(User $user)
    {
        return [
            'id'   		=&gt; $user['id'],
            'name' 		=&gt; $user['name'],
            'created_at'=&gt; $user-&gt;created_at-&gt;toDateTimeString()
        ];
    }
}
</code></pre></div><p><strong>返回单个数据</strong></p> <div class="language- extra-class"><pre class="language-text"><code>return $this-&gt;response-&gt;item(User::find(1),new UserTransformer());
</code></pre></div><p><strong>返回集合</strong></p> <div class="language- extra-class"><pre class="language-text"><code>return $this-&gt;response-&gt;collection(User::get(),new UserTransformer());
</code></pre></div><p><strong>分页数据</strong></p> <div class="language- extra-class"><pre class="language-text"><code>return $this-&gt;response-&gt;paginator(User::paginate(2),new UserTransformer());
</code></pre></div><h4 id="include"><a href="#include" aria-hidden="true" class="header-anchor">#</a> include</h4> <p>获取文章时我们希望获取文章的栏目数据，include的特性就非常方便了。</p> <p>下面是ContentTransformer中的定义，</p> <div class="language- extra-class"><pre class="language-text"><code>class ContentTransformer extends TransformerAbstract
{
	# 定义可以include可使用的字段
    protected $availableIncludes = ['category'];

    public function transform(Content $content)
    {
        return [
            'id'   =&gt; $content['id'],
            'name' =&gt; $content['title'],
        ];
    }

    public function includeCategory(Content $content)
    {
        return $this-&gt;item($content-&gt;category,new CategoryTransformer());
    }
}
</code></pre></div><p>当我们调用 <code>{host}/api/contents?include=category</code> 接口时，栏目数据也一并会返回</p> <div class="language- extra-class"><pre class="language-text"><code>return $this-&gt;response-&gt;paginator(Content::paginate(1),new ContentTransformer());
</code></pre></div><p>返回结果如下</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;data&quot;: [
        {
            &quot;id&quot;: 1,
            &quot;name&quot;: &quot;后盾人 人人做后盾&quot;,
            &quot;category&quot;: {
                &quot;data&quot;: {
                    &quot;id&quot;: 2,
                    &quot;name&quot;: &quot;编程&quot;
                }
            }
        }
    ],
    &quot;meta&quot;: {
        &quot;pagination&quot;: {
            &quot;total&quot;: 100,
            &quot;count&quot;: 1,
            &quot;per_page&quot;: 1,
            &quot;current_page&quot;: 1,
            &quot;total_pages&quot;: 100,
            &quot;links&quot;: {
                &quot;next&quot;: &quot;http://xiang.houdunren.com/api/contents?page=2&quot;
            }
        }
    }
}
</code></pre></div><h3 id="响应结果"><a href="#响应结果" aria-hidden="true" class="header-anchor">#</a> 响应结果</h3> <p><strong>设置响应状态码</strong></p> <div class="language- extra-class"><pre class="language-text"><code>return $this-&gt;response-&gt;array(User::get())-&gt;setStatusCode(200);
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>return response()-&gt;json(['error' =&gt; 'Unauthorized'], 401);
</code></pre></div><p><strong>错误响应</strong></p> <div class="language- extra-class"><pre class="language-text"><code>// 一个自定义消息和状态码的普通错误。
return $this-&gt;response-&gt;error('This is an error.', 404);

// 一个没有找到资源的错误，第一个参数可以传递自定义消息。
return $this-&gt;response-&gt;errorNotFound();

// 一个 bad request 错误，第一个参数可以传递自定义消息。
return $this-&gt;response-&gt;errorBadRequest();

// 一个服务器拒绝错误，第一个参数可以传递自定义消息。
return $this-&gt;response-&gt;errorForbidden();

// 一个内部错误，第一个参数可以传递自定义消息。
return $this-&gt;response-&gt;errorInternal();

// 一个未认证错误，第一个参数可以传递自定义消息。
return $this-&gt;response-&gt;errorUnauthorized('帐号或密码错误');
</code></pre></div><h3 id="限制请求数"><a href="#限制请求数" aria-hidden="true" class="header-anchor">#</a> 限制请求数</h3> <p>使用 <code>api.throttle</code>中间件结合 <code>limit、expires</code> 参数可实现接口次数限制。下面是定义在 <code>routes/api.php</code> 路由文件中的示例。</p> <div class="language- extra-class"><pre class="language-text"><code>$api-&gt;version('v1', ['namespace' =&gt; '\App\Api'], function ($api) {
    $api-&gt;group(['middleware' =&gt; 'api.throttle', 'limit' =&gt; 2, 'expires' =&gt; 1], function ($api) {
        $api-&gt;get('user', 'UserController@all');
    });
});
</code></pre></div><p>限制1分钟只能访问2次。</p> <h3 id="身份验证"><a href="#身份验证" aria-hidden="true" class="header-anchor">#</a> 身份验证</h3> <p>可以通过 <code>api.auth</code> 路由中间件来启用路由或者路由群组的保护，我们使用下面讲解的jwt组件完成接口验证。</p> <p><strong>在所有的路由上启用</strong></p> <div class="language- extra-class"><pre class="language-text"><code>$api-&gt;version('v1', ['middleware' =&gt; 'api.auth'], function ($api) {
    // 在这个版本群组下的所有路由将进行身份验证。
});
</code></pre></div><p><strong>特定的路由上启用</strong></p> <div class="language- extra-class"><pre class="language-text"><code>$api-&gt;version('v1', function ($api) {
    $api-&gt;get('user', ['middleware' =&gt; 'api.auth', function () {
        // 这个路由将进行身份验证。
    }]);

    $api-&gt;get('posts', function () {
        // 这个路由不会验证身份。
    });
});
</code></pre></div><p><strong>控制器上进行身份验证</strong></p> <p><code>Laravel</code>可以在控制器里启用中间件。您可以在构造函数里使用 <code>middleware</code> 的方法。</p> <div class="language- extra-class"><pre class="language-text"><code>class UserController extends Illuminate\Routing\Controller
{
    use Helpers;

    public function __construct()
    {
        $this-&gt;middleware('api.auth');

        // 这个中间件只在  index  中启用
        $this-&gt;middleware('api.auth', ['only' =&gt; ['index']]);
    }
...
</code></pre></div><h2 id="jwt"><a href="#jwt" aria-hidden="true" class="header-anchor">#</a> Jwt</h2> <p>Jwt是高效简单的接口验证组件，使用非常广泛。</p> <p>GitHub：https://github.com/tymondesigns/jwt-auth</p> <p>Packagist：https://packagist.org/packages/tymon/jwt-auth</p> <p>在线文档： http://jwt-auth.readthedocs.io/en/develop/quick-start/</p> <h3 id="安装组件-2"><a href="#安装组件-2" aria-hidden="true" class="header-anchor">#</a> 安装组件</h3> <p>目前2.0版本正在开发中还不可以正常使用，所以我们使用 1.0.0-rc.2。</p> <div class="language- extra-class"><pre class="language-text"><code>composer require tymon/jwt-auth:1.0.0-rc.2
</code></pre></div><p><strong>生成配置文件</strong></p> <div class="language- extra-class"><pre class="language-text"><code>php artisan vendor:publish
</code></pre></div><p><strong>生成密钥</strong></p> <p>这是用来给你的token签名的钥匙，使用以下命令生成一个密钥:</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan jwt:secret
</code></pre></div><p>这将用 <code>JWT_SECRET=foobar</code> 更新.env文件</p> <h3 id="配置说明-2"><a href="#配置说明-2" aria-hidden="true" class="header-anchor">#</a> 配置说明</h3> <p>JWT配置文件是 <code>config/jwt.php</code>，下面有部分配置项进行说明：</p> <div class="language- extra-class"><pre class="language-text"><code>#令牌过期时间(单位分钟)，设置null为永不过期
'ttl' =&gt; env('JWT_TTL', 60)

#刷新令牌时间(单位分钟)，设置为null可永久随时刷新
'refresh_ttl' =&gt; env('JWT_REFRESH_TTL', 20160)
</code></pre></div><h3 id="更新用户模型"><a href="#更新用户模型" aria-hidden="true" class="header-anchor">#</a> 更新用户模型</h3> <p>首先，您需要在用户模型上实现 <code>Tymon\JWTAuth\Contracts\JWTSubject</code> 契约，它要求您实现两个方法 <code>getJWTIdentifier()</code> 和 <code>getJWTCustomClaims()</code>。</p> <p>下面的示例应该能让您了解这可能是什么样子的。显然，您应该根据需要进行任何更改，以满足自己的需要。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;?php

namespace App;

use Tymon\JWTAuth\Contracts\JWTSubject;
use Illuminate\Notifications\Notifiable;
use Illuminate\Foundation\Auth\User as Authenticatable;

class User extends Authenticatable implements JWTSubject
{
    use Notifiable;

    /**
     * 获取将存储在JWT主题声明中的标识符.
     * 就是用户表主键 id
     *
     * @return mixed
     */
    public function getJWTIdentifier()
    {
        return $this-&gt;getKey();
    }

    /**
     * 返回一个键值数组，其中包含要添加到JWT的任何自定义声明.
     *
     * @return array
     */
    public function getJWTCustomClaims()
    {
        return [];
    }
}
</code></pre></div><h3 id="配置验证守卫"><a href="#配置验证守卫" aria-hidden="true" class="header-anchor">#</a> 配置验证守卫</h3> <p>修改 <code>config/auth.php</code> 文件以使用jwt保护来为接口身份验证提供支持。</p> <div class="language- extra-class"><pre class="language-text"><code>'guards' =&gt; [
	'web' =&gt; [
		'driver' =&gt; 'session',
		'provider' =&gt; 'users',
	],
	'api' =&gt; [
		'driver' =&gt; 'jwt',
		'provider' =&gt; 'users',
	],
]
</code></pre></div><p>修改dingo配置文件 <code>config/api.php</code> 文件中的身份验证提供者</p> <div class="language- extra-class"><pre class="language-text"><code>'auth' =&gt; [
	'jwt' =&gt; \Dingo\Api\Auth\Provider\JWT::class,
],
</code></pre></div><h3 id="验证操作"><a href="#验证操作" aria-hidden="true" class="header-anchor">#</a> 验证操作</h3> <p><strong>路由定义</strong></p> <div class="language- extra-class"><pre class="language-text"><code>$api = app(\Dingo\Api\Routing\Router::class);
$api-&gt;version('v1', ['namespace' =&gt; 'App\Http\Controllers\Api',], function ($api) {
    $api-&gt;post('login', 'AuthController@login');
    $api-&gt;get('logout', 'AuthController@logout');
    $api-&gt;get('me', 'AuthController@me');
});
</code></pre></div><p><strong>控制器定义</strong></p> <div class="language- extra-class"><pre class="language-text"><code>class AuthController extends Controller
{
    public function __construct()
    {
    	// 除login外都需要验证
        $this-&gt;middleware('auth:api', ['except' =&gt; ['login']]);
    }

    //登录获取token
    public function login()
    {
        $credentials = request(['email', 'password']);

        if (!$token = auth('api')-&gt;attempt($credentials)) {
			return $this-&gt;response-&gt;errorUnauthorized('帐号或密码错误');
        }

        return $this-&gt;respondWithToken($token);
    }

    //获取用户资料
    public function me()
    {
        return response()-&gt;json(auth('api')-&gt;user());
    }

    //销毁token
    public function logout()
    {
        auth('api')-&gt;logout();

        return response()-&gt;json(['message' =&gt; 'Successfully logged out']);
    }

    //刷新token
    public function refresh()
    {
        return $this-&gt;respondWithToken(auth('api')-&gt;refresh());
    }

    //响应token
    protected function respondWithToken($token)
    {
        return response()-&gt;json([
            'access_token' =&gt; $token,
            'token_type'   =&gt; 'bearer',
            'expires_in'   =&gt; auth('api')-&gt;factory()-&gt;getTTL() * 60,
        ]);
    }
}
</code></pre></div><h3 id="使用令牌"><a href="#使用令牌" aria-hidden="true" class="header-anchor">#</a> 使用令牌</h3> <p>当请求需要验证的api时必须带有token，下面是使用header头携带令牌数据</p> <div class="language- extra-class"><pre class="language-text"><code>Authorization: Bearer 令牌数据
</code></pre></div><p>在postman 工具中可以使用以下方式简化操作</p> <p><img src="/assets/img/image-20180810224729833.9ec08735.png" alt="image-20180810224729833"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/houdunwang/coding/edit/master/docs/laravel/API.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/6/2019, 8:37:16 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/laravel/package.html" class="prev">
          开发扩展包
        </a></span> <span class="next"><a href="/laravel/algolia.html">
          algolia
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78ae37e1.js" defer></script><script src="/assets/js/2.17f01c05.js" defer></script><script src="/assets/js/4.ab422658.js" defer></script>
  </body>
</html>
