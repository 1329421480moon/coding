<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>会话控制 | 后盾人</title>
    <meta name="description" content="在线文档库">
    
    
    <link rel="preload" href="/code/assets/css/0.styles.fcb1d57d.css" as="style"><link rel="preload" href="/code/assets/js/app.bca2b3d0.js" as="script"><link rel="preload" href="/code/assets/js/2.981a9de6.js" as="script"><link rel="preload" href="/code/assets/js/51.8018c74c.js" as="script"><link rel="prefetch" href="/code/assets/js/10.a80187a9.js"><link rel="prefetch" href="/code/assets/js/11.73e0c7ef.js"><link rel="prefetch" href="/code/assets/js/12.a8a0da58.js"><link rel="prefetch" href="/code/assets/js/13.d78db245.js"><link rel="prefetch" href="/code/assets/js/14.2701c7ee.js"><link rel="prefetch" href="/code/assets/js/15.3731fe8d.js"><link rel="prefetch" href="/code/assets/js/16.cccb1964.js"><link rel="prefetch" href="/code/assets/js/17.e5012aba.js"><link rel="prefetch" href="/code/assets/js/18.12da54a5.js"><link rel="prefetch" href="/code/assets/js/19.73b7fa43.js"><link rel="prefetch" href="/code/assets/js/20.46b91d6b.js"><link rel="prefetch" href="/code/assets/js/21.e2a46793.js"><link rel="prefetch" href="/code/assets/js/22.eff1a377.js"><link rel="prefetch" href="/code/assets/js/23.23839513.js"><link rel="prefetch" href="/code/assets/js/24.2947ae10.js"><link rel="prefetch" href="/code/assets/js/25.d7784a74.js"><link rel="prefetch" href="/code/assets/js/26.a4779340.js"><link rel="prefetch" href="/code/assets/js/27.e6ac6cf6.js"><link rel="prefetch" href="/code/assets/js/28.8dbfd7da.js"><link rel="prefetch" href="/code/assets/js/29.52e7f28b.js"><link rel="prefetch" href="/code/assets/js/3.5c8057d9.js"><link rel="prefetch" href="/code/assets/js/30.0bc3e9a7.js"><link rel="prefetch" href="/code/assets/js/31.72fd5fdd.js"><link rel="prefetch" href="/code/assets/js/32.da4abfea.js"><link rel="prefetch" href="/code/assets/js/33.7b816751.js"><link rel="prefetch" href="/code/assets/js/34.8e7da4bc.js"><link rel="prefetch" href="/code/assets/js/35.92e12cd2.js"><link rel="prefetch" href="/code/assets/js/36.c7d0b613.js"><link rel="prefetch" href="/code/assets/js/37.e449b9ce.js"><link rel="prefetch" href="/code/assets/js/38.0cb50ad7.js"><link rel="prefetch" href="/code/assets/js/39.a522b15e.js"><link rel="prefetch" href="/code/assets/js/4.523d56bd.js"><link rel="prefetch" href="/code/assets/js/40.60a1c2e9.js"><link rel="prefetch" href="/code/assets/js/41.6e042fe8.js"><link rel="prefetch" href="/code/assets/js/42.07e10eb3.js"><link rel="prefetch" href="/code/assets/js/43.402e7456.js"><link rel="prefetch" href="/code/assets/js/44.a5459a22.js"><link rel="prefetch" href="/code/assets/js/45.aedf13f7.js"><link rel="prefetch" href="/code/assets/js/46.ff58a42c.js"><link rel="prefetch" href="/code/assets/js/47.8413bced.js"><link rel="prefetch" href="/code/assets/js/48.40fd4e3d.js"><link rel="prefetch" href="/code/assets/js/49.1358bea7.js"><link rel="prefetch" href="/code/assets/js/5.69242544.js"><link rel="prefetch" href="/code/assets/js/50.2a32cb2f.js"><link rel="prefetch" href="/code/assets/js/52.2c4bfe2d.js"><link rel="prefetch" href="/code/assets/js/53.97b3c978.js"><link rel="prefetch" href="/code/assets/js/54.7674e5b7.js"><link rel="prefetch" href="/code/assets/js/55.9f385dd8.js"><link rel="prefetch" href="/code/assets/js/56.1fd05224.js"><link rel="prefetch" href="/code/assets/js/57.17dbac44.js"><link rel="prefetch" href="/code/assets/js/58.2928ef92.js"><link rel="prefetch" href="/code/assets/js/59.4374057e.js"><link rel="prefetch" href="/code/assets/js/6.85d87b30.js"><link rel="prefetch" href="/code/assets/js/60.1103a418.js"><link rel="prefetch" href="/code/assets/js/7.f93228a2.js"><link rel="prefetch" href="/code/assets/js/8.fcbd293b.js"><link rel="prefetch" href="/code/assets/js/9.708803d7.js">
    <link rel="stylesheet" href="/code/assets/css/0.styles.fcb1d57d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/code/" class="home-link router-link-active"><!----> <span class="site-name">后盾人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/code/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/code/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/code/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/code/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/code/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/code/hdcms/HDCMS.html" class="nav-link">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档列表</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/php/1 前言.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/code/linux/ubuntu.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/code/environment/composer.html" class="nav-link">环境与软件</a></li><li class="dropdown-item"><!----> <a href="/code/docker/laradock.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/code/git/git.html" class="nav-link">GIT</a></li><li class="dropdown-item"><!----> <a href="/code/laravel/Laravel.html" class="nav-link">Laravel</a></li><li class="dropdown-item"><!----> <a href="/code/hdcms/HDCMS.html" class="nav-link">HDCMS</a></li></ul></div></div><div class="nav-item"><a href="https://www.houdunren.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.houdunren.com/edu/front/live" target="_blank" rel="noopener noreferrer" class="nav-link external">
  八点直播
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/houdunwang/coding" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/code/php/1 前言.html" class="sidebar-link">前言</a></li><li><a href="/code/php/2 基础知识.html" class="sidebar-link">基础知识</a></li><li><a href="/code/php/3 函数编程.html" class="sidebar-link">函数编程</a></li><li><a href="/code/php/4 数组类型.html" class="sidebar-link">数组类型</a></li><li><a href="/code/php/5 正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/code/php/6 文件与目录.html" class="sidebar-link">文件与目录</a></li><li><a href="/code/php/7 文件上传.html" class="sidebar-link">文件上传</a></li><li><a href="/code/php/8 会话控制.html" class="active sidebar-link">会话控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#cookie" class="sidebar-link">COOKIE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#设置" class="sidebar-link">设置</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#读取" class="sidebar-link">读取</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#使用" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#session" class="sidebar-link">SESSION</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#常用函数" class="sidebar-link">常用函数</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#垃圾回收" class="sidebar-link">垃圾回收</a></li><li class="sidebar-sub-header"><a href="/code/php/8 会话控制.html#自定义驱动" class="sidebar-link">自定义驱动</a></li></ul></li></ul></li><li><a href="/code/php/9 图像处理.html" class="sidebar-link">图像处理</a></li><li><a href="/code/php/10 面向对象.html" class="sidebar-link">面向对象</a></li><li><a href="/code/php/11 命名空间.html" class="sidebar-link">命名空间</a></li><li><a href="/code/php/12 错误处理.html" class="sidebar-link">错误处理</a></li><li><a href="/code/php/13 异常处理.html" class="sidebar-link">异常处理</a></li><li><a href="/code/php/14 数据库操作.html" class="sidebar-link">数据库操作</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="会话控制"><a href="#会话控制" aria-hidden="true" class="header-anchor">#</a> 会话控制</h1> <blockquote><p>创作不易，转载请注明出处： 后盾人 @ houdurnen.com</p></blockquote> <h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> HTTP</h2> <p>因为 <code>HTTP</code> 是无状态的协议，没有办法记录多个事务请求间的状态。即访问一个页面请求后再请求另一个页面时无法判断两次请求来自同一下用户。</p> <p><strong>会话原理</strong></p> <p>在PHP中实现会话的原理是为用户分配一个唯一的加密ID，并保存在用户客户端，并在整个会话时间周期内有效。</p> <p>一般情况下使用cookie来进行保存，但也可以通过url传递。</p> <p>用户通过携带会话ID到服务器获取内容。</p> <h2 id="cookie"><a href="#cookie" aria-hidden="true" class="header-anchor">#</a> COOKIE</h2> <p>cookie是客户端存储数据的手段，并在请求服务器时自动携带cookie数据。</p> <h3 id="设置"><a href="#设置" aria-hidden="true" class="header-anchor">#</a> 设置</h3> <p>PHP中使用 setcookie() 函数用户客户端cookie数据。</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie ( string $name [, string $value = &quot;&quot; [, int $expires = 0 [, string $path = &quot;&quot; [, string $domain = &quot;&quot; [, bool $secure = FALSE [, bool $httponly = FALSE ]]]]]] ) : bool
</code></pre></div><p>参数说明如下：</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>Cookie的名称</td></tr> <tr><td>value</td> <td>cookie的价值。该值存储在客户端计算机上; 不要存储敏感信息</td></tr> <tr><td>expires</td> <td>Cookie过期的时间。这是一个Unix时间戳，可以使用<a href="https://www.php.net/manual/en/function.time.php" target="_blank" rel="noopener noreferrer">time（）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>函数加上希望它到期之前的秒数来设置它。</td></tr> <tr><td><strong>path</strong></td> <td>服务器上可以使用cookie的路径。如果设置为*“/”*，则cookie将在整个范围内可用</td></tr> <tr><td><strong>domain</strong></td> <td>cookie可用的域。（例如*“www.houdunren.com”<em>）将使cookie可用于该子域及其所有其他子域（即w2.www.houdunren.com）。要使cookie可用于整个域（包括其所有子域），只需将值设置为域名（在本例中为</em>“houdunren.com”*）</td></tr> <tr><td><strong>secure</strong></td> <td>表示cookie应仅通过客户端的安全HTTPS连接传输</td></tr> <tr><td><strong>httponly</strong></td> <td>当<strong>TRUE</strong>cookie只能通过HTTP协议访问时。这意味着脚本语言（例如JavaScript）无法访问cookie。</td></tr></tbody></table> <h3 id="读取"><a href="#读取" aria-hidden="true" class="header-anchor">#</a> 读取</h3> <p>因为cookie保存在客户端并在请求时提交到后台服务器，所以可以在前台与后台访问到cookie。</p> <p>前台使用 <code>document.cookie</code> 获取cookie数据</p> <div class="language- extra-class"><pre class="language-text"><code>document.cookie
</code></pre></div><p>后台使用超全避数组$_COOKIE读取</p> <div class="language- extra-class"><pre class="language-text"><code>print_r($_COOKIE);
</code></pre></div><h3 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h3> <p>设置会话cookie，当关闭浏览器时自动删除</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','houdunren.com');
</code></pre></div><p>设置七天内有效的cookie</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','houdunren.com',time()+60*60*24*7);
</code></pre></div><p>只允许cookie在 <code>/app</code> 访问路径中有效</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','houdunren.com',0,'/app')
</code></pre></div><p>设置访问域名</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','hdcms.com',0,'/','php.test')
</code></pre></div><p>设置只允许https访问</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','hdcms.com',0,'/','',true);
</code></pre></div><p>不允许javascript操作cookie</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('web','hdcms.com',0,'','',false,false,true);
</code></pre></div><p>将<code>cookie</code>的到期时间设置为过去时间，就可以删除cookie。</p> <div class="language- extra-class"><pre class="language-text"><code>setcookie('name','',1);
</code></pre></div><h2 id="session"><a href="#session" aria-hidden="true" class="header-anchor">#</a> SESSION</h2> <p>session是服务器会话状态，可用于记录访问用户后台会话数据。</p> <h3 id="基本使用"><a href="#基本使用" aria-hidden="true" class="header-anchor">#</a> 基本使用</h3> <h4 id="开启会话"><a href="#开启会话" aria-hidden="true" class="header-anchor">#</a> 开启会话</h4> <p>必须要开启 SESSION 才可以使用，有两种方法可以开启会话。</p> <ol><li>使用脚本开启会话，要保证在使用会话的所有脚本中执行。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>session_start();
</code></pre></div><ol start="2"><li>通过修改php.ini配置项 <code>session.auto_start</code>，自动开启会话（不建议使用）</li></ol> <h4 id="会话变量"><a href="#会话变量" aria-hidden="true" class="header-anchor">#</a> 会话变量</h4> <p>使用超全局数组 <code>$_SESSION</code> 来使用会话变量。</p> <p>设置变量</p> <div class="language- extra-class"><pre class="language-text"><code>$_SESSION['name']='houdunren.com';
</code></pre></div><p>删除变量</p> <div class="language- extra-class"><pre class="language-text"><code>unset($_SESSION['name']);
</code></pre></div><p>删除所有变量</p> <div class="language- extra-class"><pre class="language-text"><code>$_SESSION = [];
# 或使用函数删除
session_destroy();
</code></pre></div><h3 id="常用函数"><a href="#常用函数" aria-hidden="true" class="header-anchor">#</a> 常用函数</h3> <h4 id="session-save-path"><a href="#session-save-path" aria-hidden="true" class="header-anchor">#</a> session_save_path</h4> <p>设置服务器会话数据储存目录，必须在session_start前使用。</p> <h4 id="session-id"><a href="#session-id" aria-hidden="true" class="header-anchor">#</a> session_id</h4> <p>通过 <code>session_id</code> 函数来获取/设置当前会话 ID。</p> <h4 id="session-name"><a href="#session-name" aria-hidden="true" class="header-anchor">#</a> session_name</h4> <p>获取或设置会话COOKIE名称，如果设置会话名称则需要在session_id前调用。</p> <h3 id="垃圾回收"><a href="#垃圾回收" aria-hidden="true" class="header-anchor">#</a> 垃圾回收</h3> <h4 id="session-gc-probability"><a href="#session-gc-probability" aria-hidden="true" class="header-anchor">#</a> session.gc_probability</h4> <p>session清除无效session的基率。</p> <h4 id="session-gc-divisor"><a href="#session-gc-divisor" aria-hidden="true" class="header-anchor">#</a> session.gc_divisor</h4> <p>启动垃圾回收程序的概率。概率计算公式为：session.gc_probability/session.gc_divisor，如果网站访问量大建议将概率降低如 1/1000~5000。</p> <h4 id="session-gc-maxlifetime"><a href="#session-gc-maxlifetime" aria-hidden="true" class="header-anchor">#</a> session.gc_maxlifetime</h4> <p>session文件过期时间，超过这个时间没有使用的session将视为垃圾，将在下次垃圾回收时删除。</p> <h3 id="自定义驱动"><a href="#自定义驱动" aria-hidden="true" class="header-anchor">#</a> 自定义驱动</h3> <p>自定义SESSION处理驱动可以让我们更灵活的管理SESSION，并更好的服务我们网站业务。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;?php
class FileHandle implements SessionHandlerInterface
{
    //写入目录
    protected $path = 'session';
    //过期时间
    protected $maxlifetime = 1440;
    /**
     * 构建函数
     *
     * @param string $path 保存目录
     * @param integer $maxlifetime 过期时间
     */
    public function __construct(string $path = 'session', int $maxlifetime = 1440)
    {
        $this-&gt;path = realpath($path);
        $this-&gt;maxlifetime = $maxlifetime;
    }
    /**
     * 关闭
     *
     * @return void
     */
    public function close()
    {
        return true;
    }
    /**
     * 销毁
     *
     * @param [type] $session_id
     * @return void
     */
    public function destroy($session_id)
    {
        return (bool)@unlink($this-&gt;path . '/' . $session_id);
    }
    /**
     * 垃圾回收
     *
     * @param [type] $maxlifetime
     * @return void
     */
    public function gc($maxlifetime)
    {
        foreach (glob($this-&gt;path . '/*') as $file) {
            if (filemtime($file) + $this-&gt;maxlifetime &lt; time()) {
                @unlink($file);
            }
        }
        return true;
    }
    /**
     * 开启
     *
     * @param [type] $save_path
     * @param [type] $session_name
     * @return void
     */
    public function open($save_path,  $session_name)
    {
        is_dir($this-&gt;path) or mkdir($this-&gt;path, 0755, true);
        return true;
    }
    /**
     * 读取会话数据
     *
     * @param [type] $session_id
     * @return void
     */
    public function read($session_id)
    {
        return file_get_contents($this-&gt;path . '/' . $session_id);
    }
    /**
     * 写入会话
     *
     * @param [type] $session_id
     * @param [type] $session_data
     * @return void
     */
    public function write($session_id,  $session_data)
    {
        return (bool)file_put_contents($this-&gt;path . '/' . $session_id, $session_data);
    }
}
</code></pre></div><p>调用方法</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;?php
include 'Session.php';
//声明会话引擎
session_set_save_handler(new FileHandle);
session_start();
$_SESSION['web'] = 'houdunren.com';
$_SESSION['cms'] = 'hdcms.com';

print_r($_SESSION);
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/houdunwang/coding/edit/master/docs/php/8 会话控制.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/6/2019, 8:37:16 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/code/php/7 文件上传.html" class="prev">
          文件上传
        </a></span> <span class="next"><a href="/code/php/9 图像处理.html">
          图像处理
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/code/assets/js/app.bca2b3d0.js" defer></script><script src="/code/assets/js/2.981a9de6.js" defer></script><script src="/code/assets/js/51.8018c74c.js" defer></script>
  </body>
</html>
